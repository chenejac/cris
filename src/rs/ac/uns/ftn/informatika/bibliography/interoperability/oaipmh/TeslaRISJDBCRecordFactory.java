package rs.ac.uns.ftn.informatika.bibliography.interoperability.oaipmh;

import rs.ac.uns.ftn.informatika.bibliography.dao.RecordDAO;
import rs.ac.uns.ftn.informatika.bibliography.db.RecordDB;
import rs.ac.uns.ftn.informatika.bibliography.dto.AuthorDTO;
import rs.ac.uns.ftn.informatika.bibliography.dto.InstitutionDTO;
import rs.ac.uns.ftn.informatika.bibliography.dto.RecordDTO;
import rs.ac.uns.ftn.informatika.bibliography.dto.Types;

import java.util.*;

public class TeslaRISJDBCRecordFactory extends CRISUNSJDBCRecordFactory{

	public TeslaRISJDBCRecordFactory(Properties properties)
			throws IllegalArgumentException {
		super(properties);
	}

	/* (non-Javadoc)
	 * @see ORG.oclc.oai.server.catalog.ExtendedJDBCRecordFactory#isDeleted(java.lang.Object)
	 */
	@Override
	public boolean isDeleted(Object nativeItem) throws IllegalArgumentException {
		boolean retVal = false;
		if(keepDeletedRecord.equals("persistent")){
			HashMap table = (HashMap)nativeItem;
		    Object deleted = table.get(deletedLabel);
	        if (deleted instanceof Integer) {
	        	if(((Integer) deleted).intValue() == 100){
	        		retVal = true;
	        	} else {
					RecordDAO recordDAO = new RecordDAO(new RecordDB());
					RecordDTO dto = recordDAO.getDTO(table.get(identifierLabel).toString());
					if (dto instanceof AuthorDTO){
						if ((((AuthorDTO) dto).getInstitution() == null
								|| ((AuthorDTO) dto).getInstitution().getControlNumber() == null
								|| (!TeslaRISJDBCRecordFactory.customersInstitutions.contains(((AuthorDTO) dto).getInstitution().getControlNumber()))) &&
						   (! recordDAO.linksRecordsOfCertainTypes(TeslaRISJDBCRecordFactory.typesPHD, dto.getControlNumber()))) {
							retVal = true;
						}
					} else if (dto instanceof InstitutionDTO){
						if ( dto.getControlNumber() == null
								|| ((!TeslaRISJDBCRecordFactory.customersInstitutions.contains(dto.getControlNumber()))) &&
								(!recordDAO.isLinkedByRecordsOfCertainTypes(TeslaRISJDBCRecordFactory.typesPHD, dto.getControlNumber())) ) {
							retVal = true;
						}
					}
				}
	        }
		}
		return retVal;
	}

	public static Set<String> customersInstitutions = new HashSet<>(
			Arrays.asList(
					"(BISIS)6705",
					"(BISIS)5920",
					"(BISIS)114901",
					"(BISIS)128464",
					"(BISIS)5928",
					"(BISIS)6765",
					"(BISIS)6826",
					"(BISIS)6827",
					"(BISIS)6828",
					"(BISIS)6829",
					"(BISIS)6766",
					"(BISIS)6830",
					"(BISIS)6831",
					"(BISIS)6832",
					"(BISIS)6833",
					"(BISIS)6767",
					"(BISIS)6834",
					"(BISIS)6835",
					"(BISIS)6836",
					"(BISIS)6768",
					"(BISIS)6862",
					"(BISIS)6769",
					"(BISIS)6845",
					"(BISIS)6846",
					"(BISIS)6847",
					"(BISIS)6848",
					"(BISIS)6849",
					"(BISIS)6850",
					"(BISIS)6770",
					"(BISIS)6842",
					"(BISIS)6843",
					"(BISIS)6844",
					"(BISIS)6771",
					"(BISIS)6851",
					"(BISIS)6852",
					"(BISIS)6853",
					"(BISIS)6772",
					"(BISIS)6856",
					"(BISIS)6857",
					"(BISIS)6858",
					"(BISIS)6773",
					"(BISIS)6854",
					"(BISIS)6855",
					"(BISIS)6774",
					"(BISIS)6837",
					"(BISIS)6838",
					"(BISIS)6839",
					"(BISIS)6840",
					"(BISIS)6775",
					"(BISIS)6863",
					"(BISIS)6776",
					"(BISIS)6841",
					"(BISIS)6777",
					"(BISIS)6859",
					"(BISIS)6860",
					"(BISIS)6861",
					"(BISIS)5929",
					"(BISIS)6778",
					"(BISIS)105977",
					"(BISIS)106923",
					"(BISIS)6864",
					"(BISIS)6865",
					"(BISIS)6866",
					"(BISIS)6867",
					"(BISIS)6868",
					"(BISIS)7098",
					"(BISIS)6779",
					"(BISIS)6869",
					"(BISIS)6870",
					"(BISIS)6871",
					"(BISIS)6872",
					"(BISIS)6873",
					"(BISIS)6780",
					"(BISIS)106924",
					"(BISIS)6874",
					"(BISIS)6875",
					"(BISIS)6876",
					"(BISIS)6877",
					"(BISIS)6878",
					"(BISIS)6879",
					"(BISIS)83990",
					"(BISIS)6781",
					"(BISIS)6880",
					"(BISIS)6881",
					"(BISIS)6882",
					"(BISIS)6883",
					"(BISIS)6884",
					"(BISIS)6885",
					"(BISIS)6886",
					"(BISIS)6782",
					"(BISIS)27362",
					"(BISIS)6887",
					"(BISIS)6888",
					"(BISIS)6889",
					"(BISIS)6890",
					"(BISIS)6891",
					"(BISIS)6892",
					"(BISIS)6893",
					"(BISIS)6894",
					"(BISIS)6895",
					"(BISIS)5930",
					"(BISIS)6789",
					"(BISIS)6896",
					"(BISIS)6897",
					"(BISIS)6790",
					"(BISIS)6898",
					"(BISIS)6791",
					"(BISIS)6899",
					"(BISIS)6792",
					"(BISIS)6900",
					"(BISIS)6793",
					"(BISIS)6901",
					"(BISIS)6794",
					"(BISIS)6902",
					"(BISIS)6795",
					"(BISIS)6903",
					"(BISIS)6796",
					"(BISIS)6904",
					"(BISIS)6797",
					"(BISIS)6905",
					"(BISIS)6798",
					"(BISIS)6906",
					"(BISIS)6799",
					"(BISIS)6907",
					"(BISIS)6800",
					"(BISIS)6908",
					"(BISIS)6801",
					"(BISIS)6909",
					"(BISIS)6802",
					"(BISIS)6910",
					"(BISIS)6803",
					"(BISIS)6911",
					"(BISIS)6804",
					"(BISIS)6912",
					"(BISIS)6805",
					"(BISIS)6913",
					"(BISIS)5931",
					"(BISIS)6813",
					"(BISIS)7069",
					"(BISIS)7070",
					"(BISIS)7071",
					"(BISIS)7072",
					"(BISIS)7073",
					"(BISIS)6814",
					"(BISIS)7074",
					"(BISIS)7075",
					"(BISIS)7076",
					"(BISIS)7077",
					"(BISIS)6815",
					"(BISIS)7078",
					"(BISIS)7079",
					"(BISIS)7080",
					"(BISIS)7081",
					"(BISIS)6816",
					"(BISIS)7082",
					"(BISIS)7083",
					"(BISIS)7084",
					"(BISIS)7085",
					"(BISIS)7086",
					"(BISIS)7087",
					"(BISIS)6817",
					"(BISIS)7088",
					"(BISIS)7089",
					"(BISIS)7090",
					"(BISIS)6818",
					"(BISIS)7091",
					"(BISIS)7092",
					"(BISIS)6819",
					"(BISIS)7093",
					"(BISIS)7094",
					"(BISIS)7095",
					"(BISIS)7096",
					"(BISIS)6820",
					"(BISIS)7097",
					"(BISIS)5932",
					"(BISIS)5933",
					"(BISIS)85798",
					"(BISIS)85799",
					"(BISIS)85800",
					"(BISIS)85801",
					"(BISIS)85802",
					"(BISIS)85803",
					"(BISIS)85804",
					"(BISIS)85805",
					"(BISIS)5934",
					"(BISIS)6783",
					"(BISIS)6784",
					"(BISIS)6785",
					"(BISIS)6786",
					"(BISIS)6787",
					"(BISIS)6788",
					"(BISIS)5935",
					"(BISIS)6806",
					"(BISIS)6933",
					"(BISIS)6934",
					"(BISIS)6935",
					"(BISIS)6936",
					"(BISIS)6937",
					"(BISIS)6938",
					"(BISIS)6939",
					"(BISIS)6940",
					"(BISIS)6941",
					"(BISIS)6942",
					"(BISIS)6943",
					"(BISIS)6944",
					"(BISIS)6945",
					"(BISIS)6946",
					"(BISIS)6947",
					"(BISIS)6948",
					"(BISIS)6949",
					"(BISIS)6950",
					"(BISIS)6951",
					"(BISIS)6952",
					"(BISIS)6953",
					"(BISIS)6954",
					"(BISIS)6955",
					"(BISIS)6956",
					"(BISIS)6957",
					"(BISIS)6958",
					"(BISIS)6959",
					"(BISIS)6960",
					"(BISIS)6961",
					"(BISIS)6962",
					"(BISIS)6963",
					"(BISIS)6964",
					"(BISIS)6965",
					"(BISIS)6966",
					"(BISIS)6807",
					"(BISIS)6967",
					"(BISIS)6968",
					"(BISIS)6969",
					"(BISIS)6970",
					"(BISIS)6971",
					"(BISIS)6972",
					"(BISIS)6973",
					"(BISIS)6974",
					"(BISIS)6975",
					"(BISIS)6976",
					"(BISIS)6977",
					"(BISIS)6978",
					"(BISIS)6979",
					"(BISIS)6980",
					"(BISIS)6981",
					"(BISIS)6982",
					"(BISIS)6983",
					"(BISIS)6984",
					"(BISIS)6985",
					"(BISIS)6986",
					"(BISIS)6987",
					"(BISIS)6988",
					"(BISIS)6989",
					"(BISIS)6990",
					"(BISIS)6991",
					"(BISIS)6992",
					"(BISIS)6993",
					"(BISIS)6994",
					"(BISIS)6995",
					"(BISIS)6996",
					"(BISIS)6997",
					"(BISIS)6998",
					"(BISIS)6999",
					"(BISIS)7000",
					"(BISIS)6808",
					"(BISIS)7001",
					"(BISIS)7002",
					"(BISIS)7003",
					"(BISIS)7004",
					"(BISIS)7005",
					"(BISIS)7006",
					"(BISIS)7007",
					"(BISIS)7008",
					"(BISIS)7009",
					"(BISIS)7010",
					"(BISIS)7011",
					"(BISIS)7012",
					"(BISIS)7013",
					"(BISIS)7014",
					"(BISIS)7015",
					"(BISIS)7016",
					"(BISIS)7017",
					"(BISIS)7018",
					"(BISIS)7019",
					"(BISIS)7020",
					"(BISIS)7021",
					"(BISIS)7022",
					"(BISIS)7023",
					"(BISIS)7024",
					"(BISIS)7025",
					"(BISIS)7026",
					"(BISIS)7027",
					"(BISIS)7028",
					"(BISIS)7029",
					"(BISIS)7030",
					"(BISIS)7031",
					"(BISIS)7032",
					"(BISIS)7033",
					"(BISIS)7034",
					"(BISIS)6809",
					"(BISIS)7035",
					"(BISIS)7036",
					"(BISIS)7037",
					"(BISIS)7038",
					"(BISIS)7039",
					"(BISIS)7040",
					"(BISIS)7041",
					"(BISIS)7042",
					"(BISIS)7043",
					"(BISIS)7044",
					"(BISIS)7045",
					"(BISIS)7046",
					"(BISIS)7047",
					"(BISIS)7048",
					"(BISIS)7049",
					"(BISIS)7050",
					"(BISIS)7051",
					"(BISIS)7052",
					"(BISIS)7053",
					"(BISIS)7054",
					"(BISIS)7055",
					"(BISIS)7056",
					"(BISIS)7057",
					"(BISIS)7058",
					"(BISIS)7059",
					"(BISIS)7060",
					"(BISIS)7061",
					"(BISIS)7062",
					"(BISIS)7063",
					"(BISIS)7064",
					"(BISIS)7065",
					"(BISIS)7066",
					"(BISIS)7067",
					"(BISIS)7068",
					"(BISIS)5936",
					"(BISIS)6810",
					"(BISIS)6914",
					"(BISIS)6915",
					"(BISIS)6916",
					"(BISIS)6917",
					"(BISIS)6811",
					"(BISIS)6918",
					"(BISIS)6919",
					"(BISIS)6920",
					"(BISIS)6921",
					"(BISIS)6922",
					"(BISIS)6923",
					"(BISIS)6924",
					"(BISIS)6812",
					"(BISIS)6925",
					"(BISIS)6926",
					"(BISIS)6927",
					"(BISIS)6928",
					"(BISIS)6929",
					"(BISIS)6930",
					"(BISIS)6931",
					"(BISIS)6932",
					"(BISIS)5937",
					"(BISIS)5938",
					"(BISIS)5939",
					"(BISIS)5940",
					"(BISIS)5941",
					"(BISIS)5963",
					"(BISIS)8011",
					"(BISIS)82773",
					"(BISIS)94894",
					"(BISIS)107024",
					"(BISIS)130342",
					"(BISIS)94895",
					"(BISIS)94896",
					"(BISIS)94897",
					"(BISIS)94898"));

	public static String[] typesPHD = {Types.PHD_STUDY_FINAL_DOCUMENT, Types.PHD_ART_PROJECT, Types.MASTER_STUDY_FINAL_DOCUMENT,
			Types.OLD_MASTER_STUDY_FINAL_DOCUMENT, Types.BACHELOR_STUDY_FINAL_DOCUMENT, Types.OLD_BACHELOR_STUDY_FINAL_DOCUMENT,
			Types.SPECIALISTIC_STUDY_FINAL_DOCUMENT, Types.STUDY_FINAL_DOCUMENT};
}
