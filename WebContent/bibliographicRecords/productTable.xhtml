<ui:composition xmlns="http://www.w3.org/1999/xhtml"
     xmlns:ui="http://java.sun.com/jsf/facelets"
     xmlns:h="http://java.sun.com/jsf/html"
     xmlns:f="http://java.sun.com/jsf/core"
     xmlns:p="http://primefaces.org/ui"
     xmlns:mytags="http://dragan.tmd.uns.ac.rs/mytags">

	<h:panelGrid id="productTableFormPanel" >
		<p:inputText id="general" rendered="false" value="" />
		<p:outputPanel ajaxRendered="true">
			<p:message
				for="general"
				errorClass="errorMessage"
				infoClass="infoMessage"
				warnClass="warnMessage"
				fatalClass="fatalMessage"/>
		</p:outputPanel>
		<h:panelGrid
			rendered="#{(empty userManagedBean.loggedUser.author.controlNumber)}">
			<!-- ===========================   searchPanel  ============================= -->
			<p:spacer
				height="10"
				width="1"
				/>
			<h:panelGrid 
				id="productSearchPanel"
				columns="4">
				<h:panelGroup>
					<h2>
						<p:outputPanel ajaxRendered="true">
							<mytags:outputLabel 
								value="#{messages['records.product.searchPanel.header']}: " 
								for="whereStr" 
								errorStyleClass="errorMessage"
								/>
						</p:outputPanel>
					</h2>
				</h:panelGroup>
				<p:inputText
					id="whereStr"
					onkeydown="keyDownHandler(event, 'productTableForm:btnFind')"
					value="#{productManagedBean.whereStr}" 
					styleClass="searchBox" />
				<p:commandButton
					id="btnFind"
					value="#{messages['records.product.searchPanel.btnFind']}"
					render="productTablePanel" 
					limitRender="true" 
					execute="@form" />
				<p:commandButton
					id="btnShowAll"
					action="#{productManagedBean.removeFilter}"
					value="#{messages['records.product.searchPanel.btnShowAll']}"
					render="productTablePanel, productSearchPanel"
					execute="@this" 
					limitRender="true" />
			</h:panelGrid>
		</h:panelGrid>
		<!-- ===========================   tablePanel  ============================= -->
		<p:spacer
			height="10"
			width="1"
			/>
		<h:panelGrid id="productTablePanel">
			<p:dataTable
				id="productTable"
				value="#{productManagedBean.products}"
				var="productRow" 
				rows="10"
				paginator="true" paginatorPosition="bottom"
				paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
				currentPageReportTemplate="#{userManagedBean.currentPageReportTemplate}"
				rowsPerPageTemplate="#{userManagedBean.rowsPerPageTemplate}"
				 >
				<!--     ........  reference   .......-->
				<p:column
					style="#{productManagedBean.selectedProduct.controlNumber == productRow.controlNumber?'background-color:#A1A1A1;':'background-color:#{org.richfaces.SKIN.tableBackgroundColor}'};">
					<f:facet name="header">
						<p:commandLink
							action="#{productManagedBean.sort}"
							render="productTable"
							limitRender="true" 
							execute="@this" 
							immediate="true">
							<h:outputText
								value="#{messages['records.product.tablePanel.reference']}" />
							<h:graphicImage 
								library="img" name="up.gif"
								rendered="#{(productManagedBean.orderBy=='author.name.firstname') and (productManagedBean.direction=='asc')}" />
							<h:graphicImage 
								library="img" name="down.gif"
								rendered="#{(productManagedBean.orderBy=='author.name.firstname') and (productManagedBean.direction=='desc')}" />
							<f:param name="orderBy" value="author.name.firstname" />
						</p:commandLink>
					</f:facet>
					<h:outputText value="#{productRow.stringRepresentation}" />
				</p:column>
				<!--     ........  actions   .......-->
				<p:column
					style="#{productManagedBean.selectedProduct.controlNumber == productRow.controlNumber?'background-color:#A1A1A1;':'background-color:#{org.richfaces.SKIN.tableBackgroundColor}'};">
					<f:facet name="header">
						<h:outputText
							value="#{messages['records.product.tablePanel.actions']}" />
					</f:facet>
					<p:commandLink
						action="#{productManagedBean.switchToViewDetailsMode}"
						render="productEditModalPanel" 
						limitRender="true" 
						execute="@this"
						immediate="true">
						<h:graphicImage library="img" name="details.png" />
						<f:param name="controlNumber"
							value="#{productRow.controlNumber}" />
						<ui:include src="../bibliographicRecords/productToolTip.xhtml" />
					</p:commandLink>
					<p:commandLink
						rendered="#{userManagedBean.privileges[privilegesManagedBean.formProduct][privilegesManagedBean.update]}"
						action="#{productManagedBean.switchToUpdateMode}"
						render="productEditModalPanel"
						limitRender="true" 
						execute="@this" 
						immediate="true">
						<h:graphicImage library="img" name="edit.png" />
						<f:param name="controlNumber"
							value="#{productRow.controlNumber}" />
						<ui:include src="../bibliographicRecords/productToolTip.xhtml" />
					</p:commandLink>
					<p:commandLink
						rendered="#{userManagedBean.privileges[privilegesManagedBean.formProduct][privilegesManagedBean.delete]}"
						action="#{productManagedBean.delete}"
						onclick="if(!confirmDecision()) return false"
						render="productTablePanel"
						limitRender="true" 
						execute="@this" 
						immediate="true">
						<h:graphicImage library="img" name="delete.png" />
						<f:param name="controlNumber"
							value="#{productRow.controlNumber}" />
						<ui:include src="../bibliographicRecords/productToolTip.xhtml" />
					</p:commandLink>
				</p:column>
			</p:dataTable>
			<h:panelGrid columns="1">
				<h:panelGroup 
					rendered="#{userManagedBean.privileges[privilegesManagedBean.formProduct][privilegesManagedBean.add]}">
					<h3>
						<h:outputText
								value="#{messages['records.product.tablePanel.btnCreate']}: " />
						<p:commandLink
							action="#{productManagedBean.switchToAddMode}"
							render="productEditModalPanel"
							limitRender="true" 
							execute="@this" 
							immediate="true" >
							<h:graphicImage library="img" name="create.png" />
							<ui:include src="../bibliographicRecords/productToolTip.xhtml" />
						</p:commandLink>
					</h3>
				</h:panelGroup>
			</h:panelGrid>
		</h:panelGrid>
	</h:panelGrid>
</ui:composition>