<ui:composition xmlns="http://www.w3.org/1999/xhtml"
     xmlns:ui="http://java.sun.com/jsf/facelets"
     xmlns:h="http://java.sun.com/jsf/html"
     xmlns:f="http://java.sun.com/jsf/core"
     xmlns:p="http://primefaces.org/ui"
     xmlns:mytags="http://dragan.tmd.uns.ac.rs/mytags">

	<p:outputPanel ajaxRendered="true"
		rendered="#{(not monographManagedBean.customPick) and (monographManagedBean.pickMessage!=null)}">
		<h:panelGrid columns="2">
			<h:graphicImage library="img" name="info.png" />
			<h:outputText value="#{monographManagedBean.pickMessage}"
				styleClass="ui-message-info" />
		</h:panelGrid>
	</p:outputPanel>
	<!-- ===========================   searchPanel  ============================= -->
	<p:spacer
		height="10"
		width="1"
		/>
	<h:panelGrid 
		id="monographSearchPanel" 
		columns="4"
		rendered="#{not monographManagedBean.customPick}">
		<h:panelGroup>
			<h2>
				<p:outputPanel ajaxRendered="true">
					<mytags:outputLabel 
						value="#{messages['records.paperMonograph.searchPanel.header']}: " 
						for="whereStr" 
						errorStyleClass="errorMessage"
						/>
				</p:outputPanel>
			</h2>
		</h:panelGroup>
		<p:inputText
			id="whereStr"
			onkeydown="keyDownHandler(event, 'monographPickForm:btnFind')"
			value="#{monographManagedBean.whereStr}" 
			styleClass="searchBox" />
		<p:commandButton
			id="btnFind"
			value="#{messages['records.monograph.searchPanel.btnFind']}"
			render="monographTablePanel" 
			limitRender="true" 
			execute="@form" />
		<p:commandButton
			id="btnShowAll"
			action="#{monographManagedBean.removeFilter}"
			value="#{messages['records.monograph.searchPanel.btnShowAll']}"
			render="monographTablePanel, monographSearchPanel"
			limitRender="true" 
			execute="@this" />
	</h:panelGrid>
	<p:panel
			id="scrollableBody"
			styleClass="scrollableBody" 
			rendered="#{(not empty monographManagedBean.monographs) or (not monographManagedBean.customPick)}" >
		<!-- ===========================   tablePanel  ============================= -->
		<p:spacer
			height="10"
			width="1"
			/>
		<h:panelGrid id="monographTablePanel">
			<p:dataTable
				id="monographTable"
				value="#{monographManagedBean.monographs}" 
				var="monographRow"
				rows="10"
				paginator="true" paginatorPosition="bottom"
				paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
				currentPageReportTemplate="#{userManagedBean.currentPageReportTemplate}"
				rowsPerPageTemplate="#{userManagedBean.rowsPerPageTemplate}"
				>
				<!--     ........  title   .......-->
				<p:column
					rendered="#{monographManagedBean.tableMode == modesManagedBean.pick}"
					style="#{monographManagedBean.selectedMonograph.controlNumber == monographRow.controlNumber?'background-color:#A1A1A1;':'background-color:#{org.richfaces.SKIN.tableBackgroundColor}'};"
					styleClass="ui-datatable-wide-cell" >
					
					<f:facet name="header">
						<p:commandLink
							action="#{monographManagedBean.sort}"
							render="monographTablePanel"
							limitRender="true"
							execute="@this"
							immediate="true">
							<h:outputText
								value="#{messages['records.monograph.tablePanel.title']}" />
							<h:graphicImage library="img" name="up.gif"
								rendered="#{(monographManagedBean.orderBy=='someTitle') and (monographManagedBean.direction=='asc')}" />
							<h:graphicImage library="img" name="down.gif"
								rendered="#{(monographManagedBean.orderBy=='someTitle') and (monographManagedBean.direction=='desc')}" />
							<f:param name="orderBy" value="someTitle" />
						</p:commandLink>
					</f:facet>
					<h:outputText value="#{monographRow.someTitle}" />
				</p:column>
				<!--     ........  isbn  .......-->
				<p:column
					rendered="#{monographManagedBean.tableMode == modesManagedBean.pick}"
					style="#{monographManagedBean.selectedMonograph.controlNumber == monographRow.controlNumber?'background-color:#A1A1A1;':'background-color:#{org.richfaces.SKIN.tableBackgroundColor}'};">
					<f:facet name="header">
						<p:commandLink
							action="#{monographManagedBean.sort}"
							render="monographTablePanel"
							limitRender="true"
							execute="@this"
							immediate="true">
							<h:outputText
								value="#{messages['records.monograph.tablePanel.isbn']}" />
							<h:graphicImage library="img" name="up.gif"
								rendered="#{(monographManagedBean.orderBy=='isbn') and (monographManagedBean.direction=='asc')}" />
							<h:graphicImage library="img" name="down.gif"
								rendered="#{(monographManagedBean.orderBy=='isbn') and (monographManagedBean.direction=='desc')}" />
							<f:param name="orderBy" value="isbn" />
						</p:commandLink>
					</f:facet>
					<h:outputText value="#{monographRow.isbn}" />
				</p:column>
				<!--     ........  reference   .......-->
				<p:column
					rendered="#{monographManagedBean.tableMode == modesManagedBean.browse}"
					style="#{monographManagedBean.selectedMonograph.controlNumber == monographRow.controlNumber?'background-color:#A1A1A1;':'background-color:#{org.richfaces.SKIN.tableBackgroundColor}'};">
					<f:facet name="header">
						<p:commandLink
							action="#{monographManagedBean.sort}"
							render="monographTable"
							limitRender="true" 
							execute="@this" 
							immediate="true">
							<h:outputText
								value="#{messages['records.monograph.tablePanel.reference']}" />
							<h:graphicImage 
								library="img" name="up.gif"
								rendered="#{(monographManagedBean.orderBy=='someTitle') and (monographManagedBean.direction=='asc')}" />
							<h:graphicImage 
								library="img" name="down.gif"
								rendered="#{(monographManagedBean.orderBy=='someTitle') and (monographManagedBean.direction=='desc')}" />
							<f:param name="orderBy" value="someTitle" />
						</p:commandLink>
					</f:facet>
					<h:outputText value="#{monographRow.stringRepresentation}" />
				</p:column>
				<!--     ........  actions   .......-->
				<p:column
					style="#{monographManagedBean.selectedMonograph.controlNumber == monographRow.controlNumber?'background-color:#A1A1A1;':'background-color:#{org.richfaces.SKIN.tableBackgroundColor}'}; cursor:pointer;">
					<f:facet name="header">
						<h:outputText
							value="#{messages['records.monograph.tablePanel.actions']}" />
					</f:facet>
					<p:commandLink
						action="#{monographManagedBean.switchToViewDetailsMode}"
						render="monographEditModalPanel" 
						limitRender="true"
						execute="@this" 
						immediate="true">
						<h:graphicImage library="img" name="details.png" />
						<f:param name="controlNumber"
							value="#{monographRow.controlNumber}" />
						<ui:include src="../bibliographicRecords/monographToolTip.xhtml"/>
					</p:commandLink>
					<p:commandLink
						rendered="#{userManagedBean.privileges[privilegesManagedBean.formMonograph][privilegesManagedBean.update]}"
						action="#{monographManagedBean.switchToSimpleUpdateMode}"
						render="monographSimpleEditModalPanel"
						limitRender="true" 
						execute="@this" 
						immediate="true">
						<h:graphicImage library="img" name="edit.png" />
						<f:param name="controlNumber"
							value="#{monographRow.controlNumber}" />
						<ui:include src="../bibliographicRecords/monographToolTip.xhtml"/>
					</p:commandLink>
					<p:commandLink
						rendered="#{userManagedBean.privileges[privilegesManagedBean.formMonograph][privilegesManagedBean.delete]}"
						action="#{monographManagedBean.delete}"
						onclick="if(!confirmDecision()) return false"
						render="monographTablePanel"
						limitRender="true" 
						execute="@this" 
						immediate="true">
						<h:graphicImage library="img" name="delete.png" />
						<f:param name="controlNumber"
							value="#{monographRow.controlNumber}" />
						<ui:include src="../bibliographicRecords/monographToolTip.xhtml"/>
					</p:commandLink>
					<p:commandLink
						action="#{monographManagedBean.chooseMonograph}"
						rendered="#{monographManagedBean.tableMode == modesManagedBean.pick}"
						render="mainPanel, #{monographManagedBean.renderModalPanels}"
						execute="@this" 
						immediate="true">
						<h:graphicImage library="img" name="pick.png" />
						<f:param name="controlNumber"
							value="#{monographRow.controlNumber}" />
						<ui:include src="../bibliographicRecords/monographToolTip.xhtml"/>
					</p:commandLink>
					<p:commandLink
						render="relatedRecordsEditModalPanel"
					    execute="@this" 
					    limitRender="true" >
					    <h:graphicImage id="relatedRecords" library="img" name="publications.png" />
					    <f:setPropertyActionListener target="#{relatedRecordsManagedBean.selectedRecord}"
					        value="#{monographRow}" />
					    <ui:include src="../bibliographicRecords/monographToolTip.xhtml" />
					</p:commandLink>
					<p:commandButton
						rendered="#{userManagedBean.privileges[privilegesManagedBean.formMonograph][privilegesManagedBean.delete]}"
						value="#{messages['records.monograph.tablePanel.btnChooseDuplicate']}"
						action="#{monographManagedBean.chooseDuplicateMonograph}"
						render="monographTablePanel" 
						limitRender="true" 
						execute="@this" >
						<f:param name="controlNumber" value="#{monographRow.controlNumber}" />
					</p:commandButton>
					<p:commandButton
						rendered="#{userManagedBean.privileges[privilegesManagedBean.formMonograph][privilegesManagedBean.delete]}"
						value="#{messages['records.monograph.tablePanel.btnReplaceDuplicate']}"
						action="#{monographManagedBean.replaceDuplicateMonographs}"
						render="monographBrowseModalPanel" 
						limitRender="true" 
						execute="@this" >
						<f:param name="controlNumber" value="#{monographRow.controlNumber}" />
						<p:tooltip followMouse="true" direction="topRight"
							showDelay="1000" styleClass="tooltip" mode="ajax">
							<span class="tooltipSpan"> 
								<h:panelGrid columns="1">
									<h:outputText
										value="#{monographManagedBean.duplicateMonographsAsString}" />
								</h:panelGrid> 
							</span>
						</p:tooltip>
					</p:commandButton>
				</p:column>
			</p:dataTable>
			<h:panelGrid columns="1">
				<h:panelGroup
					rendered="#{(monographManagedBean.tableMode == modesManagedBean.browse) and (userManagedBean.privileges[privilegesManagedBean.formMonograph][privilegesManagedBean.add])}">
					<h3>
						<h:outputText
							value="#{messages['records.monograph.tablePanel.btnCreate']}: " />
						<p:commandLink
							action="#{monographManagedBean.switchToSimpleAddMode}"
							render="monographSimpleEditModalPanel"
							limitRender="true" 
							execute="@this" 
							immediate="true">
							<h:graphicImage library="img" name="create.png" />
							<ui:include src="../bibliographicRecords/monographToolTip.xhtml"/>
						</p:commandLink>
					</h3>
				</h:panelGroup>
			</h:panelGrid>
		</h:panelGrid>
	</p:panel>
</ui:composition>