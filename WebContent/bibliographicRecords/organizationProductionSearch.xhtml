<ui:composition xmlns="http://www.w3.org/1999/xhtml"
				xmlns:ui="http://java.sun.com/jsf/facelets"
				xmlns:h="http://java.sun.com/jsf/html"
				xmlns:f="http://java.sun.com/jsf/core"
				xmlns:p="http://primefaces.org/ui"
				xmlns:mytags="http://dragan.tmd.uns.ac.rs/mytags"
				xmlns:fn="http://java.sun.com/jsp/jstl/functions">

	<div >
		<h:graphicImage
			library="img"
			name="spacer.gif"
			alt=""
			height="20"
			width="1"
			/>

		<!-- MAIN PANEL -->
		<h:panelGrid id="mainPanel">
			<h:panelGrid id="searchTableFormPanel" width="100%">
				<p:inputText id="general" rendered="false" value="" />
				<p:outputPanel ajaxRendered="true">
					<p:message
						for="general"
						errorClass="errorMessage"
						infoClass="infoMessage"
						warnClass="warnMessage"
						fatalClass="fatalMessage"/>
				</p:outputPanel>
				<p:panelGrid id="panelPublication" columns="1" width="100%">
					<p:dataTable id="queryTable" var="query" rowKeyVar="rowKeyVar" value="#{searchManagedBean.searchQuerys}"  columnClasses="width10, width70, width5, width20, width5">
						<p:column>
							<h:outputText
								value="#{messages['search.searchPanel.publicationTab.searchFor']}"
								rendered="#{query.id==0}"
								style="font-size: 14px" />
							<h:inputHidden value="#{query.operator}" rendered="#{query.id==0}"/>

							<p:selectOneMenu value="#{query.operator}" rendered="#{query.id!=0}" >
								<f:selectItems
									value="#{searchManagedBean.searchQueryOperator}"
									style="font-size: 14px" />
							</p:selectOneMenu>
						</p:column>
						<p:column>
							<p:fragment>
								<p:inputText
									value="#{query.inputQuery}"
									style="width:98% !important"
									rendered="#{ (query.inputQueryType != searchManagedBean.searchQueryTypeString[2]) and (query.inputQueryType != searchManagedBean.searchQueryTypeString[3]) and (query.inputQueryType != searchManagedBean.searchQueryTypeString[7]) and (query.inputQueryType != searchManagedBean.searchQueryTypeString[8]) }">
								</p:inputText>


								<p:autoComplete
										id="author"
										value="#{query.inputQuery}"
										completeMethod="#{authorManagedBean.autocompleteForSearch}"
										var="_authorRow"
										itemLabel="#{_authorRow}"
										itemValue="#{_authorRow}"
										minQueryLength="3"
										autoSelection="false"
										rendered="#{ (query.inputQueryType eq searchManagedBean.searchQueryTypeString[2]) or (query.inputQueryType eq searchManagedBean.searchQueryTypeString[3])}"
										styleClass="width100"
								/>


								<p:autoComplete
										id="journal"
										value="#{query.inputQuery}"
										completeMethod="#{journalManagedBean.autocompleteName}"
										var="_journalRow"
										itemLabel="#{_journalRow}"
										itemValue="#{_journalRow}"
										minQueryLength="3"
										autoSelection="false"
										rendered="#{query.inputQueryType eq searchManagedBean.searchQueryTypeString[8]}"
										styleClass="width100"
								/>

								<p:autoComplete
										id="conference"
										value="#{query.inputQuery}"
										completeMethod="#{conferenceManagedBean.autocompleteForSearch}"
										var="_conferenceRow"
										itemLabel="#{_conferenceRow}"
										itemValue="#{_conferenceRow}"
										minQueryLength="3"
										autoSelection="false"
										rendered="#{query.inputQueryType eq searchManagedBean.searchQueryTypeString[7]}"
										styleClass="width100"
								/>
							</p:fragment>
						</p:column>

						<p:column style="text-align:center">
							<h:outputText
								value="#{messages['search.searchPanel.publicationTab.searchIn']}"
								style="font-size: 14px"
							/>
						</p:column>
						<p:column style="text-align:center;font-size: 14px">
							<p:selectOneMenu value="#{query.inputQueryType}" valueChangeListener="#{searchManagedBean.switchToPick}"
										 enableManualInput="false" selectFirst="true" onchange="jsfSelectItemGlupaFunkcija()">
								<f:selectItem itemLabel="#{messages['search.searchPanel.publicationTab.searchTypeCh0']}" itemValue="#{searchManagedBean.searchQueryTypeString[0]}"/>
								<f:selectItem itemLabel="#{messages['search.searchPanel.publicationTab.searchTypeCh1']}" itemValue="#{searchManagedBean.searchQueryTypeString[1]}"/>
								<f:selectItem itemLabel="#{messages['search.searchPanel.publicationTab.searchTypeCh2']}" itemValue="#{searchManagedBean.searchQueryTypeString[2]}"/>
								<f:selectItem itemLabel="#{messages['search.searchPanel.publicationTab.searchTypeCh3']}" itemValue="#{searchManagedBean.searchQueryTypeString[3]}"/>
								<f:selectItem itemLabel="#{messages['search.searchPanel.publicationTab.searchTypeCh4']}" itemValue="#{searchManagedBean.searchQueryTypeString[4]}"/>
								<f:selectItem itemLabel="#{messages['search.searchPanel.publicationTab.searchTypeCh5']}" itemValue="#{searchManagedBean.searchQueryTypeString[5]}"/>
								<f:selectItem itemLabel="#{messages['search.searchPanel.publicationTab.searchTypeCh6']}" itemValue="#{searchManagedBean.searchQueryTypeString[6]}"/>
								<f:selectItem itemLabel="#{messages['search.searchPanel.publicationTab.searchTypeCh7']}" itemValue="#{searchManagedBean.searchQueryTypeString[7]}"/>
								<f:selectItem itemLabel="#{messages['search.searchPanel.publicationTab.searchTypeCh8']}" itemValue="#{searchManagedBean.searchQueryTypeString[8]}"/>
							</p:selectOneMenu>
							<p:remoteCommand
									name="jsfSelectItemGlupaFunkcija"
									update="@form" />
						</p:column>
						<p:column style="text-align:center">
							<h:graphicImage
									library="img"
									name="spacer.gif"
									alt=""
									height="20"
									width="1"
									rendered="#{query.id==0}"
							/>
							<p:commandLink
									rendered="#{query.id!=0}"
									action="#{searchManagedBean.removeQuery}"
									update="@form" >
								<h:graphicImage library="img" name="delete32.png"/>
								<f:param name="removedQuery" value="#{query.id}" />
							</p:commandLink>
						</p:column>
						<p:columnGroup type="footer">
							<p:row>
								<p:column colspan="4" style="text-align:left">
									<f:facet name="footer">
										<h:outputText
											value="#{messages['search.searchPanel.publicationTab.fuzzy']}"
											style="font-size: 14px"
										/>
										<p:selectBooleanCheckbox
											label="#{messages['search.searchPanel.publicationTab.fuzzy']}"
											value="#{searchManagedBean.fuzzy}"
											style="font-size: 14px">
										</p:selectBooleanCheckbox>
									</f:facet>
								</p:column>

								<p:column colspan="1">
									<f:facet name="footer">
										<p:commandLink
												action="#{searchManagedBean.addQuery}"
												update="@form">
											<h:graphicImage library="img" name="create32.png"/>
										</p:commandLink>
									</f:facet>
								</p:column>
							</p:row>
						</p:columnGroup>
					</p:dataTable>
				</p:panelGrid>
				<h:panelGrid id="panelPublicationLimit" columns="2" columnClasses="width10, width90">


					<h:outputText
						value="#{messages['search.searchPanel.publicationTab.limitTo']}"
						styleClass="outputTextAsHeader"/>


					<h:graphicImage
							library="img"
							name="spacer.gif"
							alt=""
							height="20"
							width="100%"
					/>

					<h:graphicImage
							library="img"
							name="spacer.gif"
							alt=""
							height="20"
							width="100%"
					/>

					<h:panelGrid columns="2" columnClasses="width60, width40" width="100%">
						<h:panelGrid columns="1" width="100%">
							<h:outputText
								value="#{messages['search.searchPanel.publicationTab.dateRange']}"
								style="font-size: 14px"/>
							<h:panelGrid columns="4" columnClasses="width25, width30,width10, width35" width="100%">
								<h:outputText
									value="#{messages['search.searchPanel.publicationTab.fromDate']}"
									style="font-size: 14px"/>
								<p:selectOneMenu value="#{searchManagedBean.fromDate}">
									<f:selectItem
										itemLabel="#{messages['search.searchPanel.publicationTab.fromDateCh0']}"
										itemValue="#{searchManagedBean.searchQueryTypeString[0]}"
										style="font-size: 14px"/>
									<f:selectItems
										value="#{searchManagedBean.dateRange}"
										style="font-size: 14px"/>
								</p:selectOneMenu>
								<h:outputText
									value="#{messages['search.searchPanel.publicationTab.toDate']}"
									style="font-size: 14px"/>
								<p:selectOneMenu value="#{searchManagedBean.toDate}">
									<f:selectItem
										itemLabel="#{messages['search.searchPanel.publicationTab.toDateCh0']}"
										itemValue="#{searchManagedBean.searchQueryTypeString[0]}"
										style="font-size: 14px"/>
									<f:selectItems
										value="#{searchManagedBean.dateRange}"
										style="font-size: 14px"/>
								</p:selectOneMenu>
							</h:panelGrid>
						</h:panelGrid>
						<h:panelGrid columns="1" width="100%">
							<h:outputText
								value="#{messages['search.searchPanel.publicationTab.publicationType']}"
								style="font-size: 14px"
							/>
							<p:selectOneMenu value="#{searchManagedBean.publicationType}">
								<f:selectItem
									itemLabel="#{messages['search.searchPanel.publicationTab.publicationTypeCh0']}"
									itemValue="#{searchManagedBean.searchQueryTypeString[0]}"
									style="font-size: 14px"
								/>
								<f:selectItem
									itemLabel="#{messages['search.searchPanel.publicationTab.publicationTypeCh1']}"
									itemValue="#{searchManagedBean.searchQueryTypeString[1]}"
									style="font-size: 14px"
								/>
								<f:selectItem
									itemLabel="#{messages['search.searchPanel.publicationTab.publicationTypeCh2']}"
									itemValue="#{searchManagedBean.searchQueryTypeString[2]}"
									style="font-size: 14px"
								/>
								<f:selectItem
									itemLabel="#{messages['search.searchPanel.publicationTab.publicationTypeCh3']}"
									itemValue="#{searchManagedBean.searchQueryTypeString[3]}"
									style="font-size: 14px"
								/>
								<f:selectItem
									itemLabel="#{messages['search.searchPanel.publicationTab.publicationTypeCh4']}"
									itemValue="#{searchManagedBean.searchQueryTypeString[4]}"
									style="font-size: 14px"
								/>
							</p:selectOneMenu>
						</h:panelGrid>
					</h:panelGrid>
				</h:panelGrid>
				<h:panelGrid id="panelPublicationSearch" columns="1" width="100%">
					<p:commandButton
							id="btnPublicationFind"
							action="#{searchManagedBean.sendPublicationForCQL}"
							value="#{messages['search.searchPanel.advanceTab.SearchBtn']}"
							update="@form"
							icon="pi pi-search"
					/>
				</h:panelGrid>
			</h:panelGrid>
		</h:panelGrid>
		<!-- MODAL PANEL -->
		<h:panelGrid id="panelResult">
			<!-- ....... SEARCH RESULTS.......           -->
			<p:panel id="panelResultPanel" rendered="#{searchManagedBean.searchResultShow}">
				<h2>
					<p:outputPanel ajaxRendered="true">
						<h:outputText
							value="#{messages['search.panelResult.CQLResultLabel']}"
							rendered="#{searchManagedBean.searchResultShow}"/>
					</p:outputPanel>
				</h2>
				<h:graphicImage
						library="img"
						name="spacer.gif"
						alt=""
						height="20"
						width="1"
				/>
				<h:panelGrid>
					<h:outputText
						value="#{searchManagedBean.searchQueryError}"
						rendered="#{not empty searchManagedBean.searchQueryError}"
						escape="false"
						style="font-size: 14px"
					/>
					<h:outputText
						value="#{messages['search.panelResult.CQLResultNumberLabel']} #{searchManagedBean.recordSize}"
						rendered="#{empty searchManagedBean.searchQueryError}"
						style="font-size: 14px"
					/>

					<h:panelGrid id="panelResultPanelGrid" rendered="#{empty searchManagedBean.searchQueryError}">
						<!--
						<h:panelGrid columns="2">
						<p:outputLabel value="#{messages['search.panelResult.representationStyle.header']}: " />
						<p:selectOneMenu value="#{searchManagedBean.representationStyle}">
							<f:selectItem
								itemValue="htmlRepresentation"
								itemLabel="#{messages['search.panelResult.representationStyle.htmlRepresentation']}" />
							<f:selectItem
								itemValue="harvardRepresentation"
								itemLabel="#{messages['search.panelResult.representationStyle.harvardRepresentation']}" />
							<p:ajax
								event="change"
								render="advanceQueryResultsTable"
								limitRender="true"
								execute="@this" />
						</p:selectOneMenu>
						</h:panelGrid>
						-->


						<h:panelGrid columns="2">
							<p:outputLabel
								value="#{messages['search.panelResult.sortMethod.header']}: "
								style="font-size: 14px"/>
							<p:selectOneMenu value="#{searchManagedBean.sortMethod}">
								<f:selectItem
										itemValue="relevance"
										itemLabel="#{messages['search.panelResult.sortMethod.relevance']}"
										style="font-size: 14px"/>
								<f:selectItem
										itemValue="date"
										itemLabel="#{messages['search.panelResult.sortMethod.date']}"
										style="font-size: 14px"/>
								<p:ajax
										event="change"
										update="@form"
										execute="@this" />
							</p:selectOneMenu>
						</h:panelGrid>


						<p:dataTable
								id="advanceQueryResultsTable"
								var="resultQuery"
								rowKeyVar="rowKeyVar"
								value="#{searchManagedBean.records}"
								rendered="#{empty searchManagedBean.searchQueryError}"
								rows="100"
								style="width:100% !important;"
								paginator="true" paginatorPosition="bottom"
								paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
								currentPageReportTemplate="#{userManagedBean.currentPageReportTemplate}"
								rowsPerPageTemplate="#{userManagedBean.rowsPerPageTemplate}"
						>
							<p:column>
								<p:commandLink
									id="showDetails"
									onclick="if(document.getElementById(this.id.replace('showDetails', 'details')).style.display=='none') document.getElementById(this.id.replace('showDetails', 'details')).style.display='block'; else document.getElementById(this.id.replace('showDetails', 'details')).style.display='none'; return false;"
								>
									<h:graphicImage library="img" name="details24.png" />
									<p:tooltip
										followMouse="true"
										direction="topRight"
										showDelay="1000"
										styleClass="tooltip"
										mode="client">
											<span class="tooltipSpan">
												<h:panelGrid columns="2">
													<h:outputText
														value="#{messages['search.panelResult.btnDetails']}"
														style="font-size: 14px"/>
												</h:panelGrid>
											</span>
									</p:tooltip>
								</p:commandLink>
								<!--   <h:outputText value="#{resultQuery.harvardRepresentation}" escape="false" rendered="#{(not empty resultQuery) and (searchManagedBean.representationStyle == 'harvardRepresentation')}"/>
								<h:outputText value="#{resultQuery.HTMLRepresentation}" escape="false" rendered="#{(not empty resultQuery) and (searchManagedBean.representationStyle == 'htmlRepresentation')}"/> -->
								<h:outputText
									value="#{resultQuery.harvardRepresentation}"
									escape="false"
									rendered="#{(not empty resultQuery)}"
									style="font-size: 14px"/>

								<p:panel
									rendered="true"
									id="details"
									style="display:none"
								>
									<p:tabView
										dynamic="true"
									>
										<p:tab
												id="HTMLDataTab"
												title="#{messages['search.panelResult.htmlTab']}" >
											<h:outputText
												value="#{resultQuery.HTMLRepresentation}"
												escape="false"
												style="font-size: 14px"
											/>
										</p:tab>
										<p:tab
												id="Download"
												title="#{messages['search.panelResult.downloadTab']}"
										>
											<!-- onenter="window.open('#{resultQuery.fileURL}', '_blank');"  -->
											<h:outputText
													rendered="#{not (((resultQuery.class.simpleName=='PatentDTO') or (resultQuery.class.simpleName=='ProductDTO') or (resultQuery.class.simpleName=='PaperJournalDTO') or (resultQuery.class.simpleName=='PaperProceedingsDTO') or (resultQuery.class.simpleName=='MonographDTO') or (resultQuery.class.simpleName=='PaperMonographDTO') or (resultQuery.class.simpleName=='StudyFinalDocumentDTO')) and (not empty resultQuery.uri))}"
													escape="false"
													value="#{messages['search.panelResult.downloadSolution']}"
													style="font-size: 14px"/>
											<h:outputLink
													rendered="#{((resultQuery.class.simpleName=='PatentDTO') or (resultQuery.class.simpleName=='ProductDTO') or(resultQuery.class.simpleName=='PaperJournalDTO') or (resultQuery.class.simpleName=='PaperProceedingsDTO') or (resultQuery.class.simpleName=='MonographDTO') or (resultQuery.class.simpleName=='PaperMonographDTO') or (resultQuery.class.simpleName=='StudyFinalDocumentDTO')) and (not empty resultQuery.uri)}"
													value="#{resultQuery.uri}"
													target="_blank"
											>
												<h:graphicImage library="img" name="download.png" width="32" height="32"/>
											</h:outputLink>
										</p:tab>
										<p:tab
												id="MARC21Tab"
												title="#{messages['search.panelResult.marc21Tab']}" >
											<h:outputText
												value="#{resultQuery.MARC21}"
												escape="false"
												style="font-size: 14px"/>
										</p:tab>
										<p:tab
												id="DublinCoreTab"
												title="#{messages['search.panelResult.dublinCoreTab']}" >
											<h:outputText
												value="#{resultQuery.dublinCore}"
												escape="false"
												style="font-size: 14px"/>
										</p:tab>
									</p:tabView>
								</p:panel>
							</p:column>
						</p:dataTable>
						<!-- maxPages +1 jer je npr 111 podeljeno 100 = 1 a nama treba 2 strane -->
					</h:panelGrid>
				</h:panelGrid>
			</p:panel>
		</h:panelGrid>
	</div>
</ui:composition>