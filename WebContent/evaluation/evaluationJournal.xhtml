<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
     xmlns:ui="http://java.sun.com/jsf/facelets"
     xmlns:h="http://java.sun.com/jsf/html"
     xmlns:f="http://java.sun.com/jsf/core"
     xmlns:p="http://primefaces.org/ui"
     xmlns:mytags="http://dragan.tmd.uns.ac.rs/mytags"
     xmlns:c="http://java.sun.com/jsp/jstl/core"
     >
	<f:view locale="#{userManagedBean.language}" 
		contentType="text/html; charset=iso-8859-1" 
		beforePhase="#{evaluationJournalManagedBean.enterPage}" >
		<h:head>
			<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
			<meta http-equiv="Refresh" content="#{session.maxInactiveInterval};url=../index.html" />
			<meta http-equiv="Pragma" content="no-cache"/>
			<meta http-equiv="Expires" content="-1"/>
			<title><ui:insert name="title">CRIS UNS</ui:insert></title>
		</h:head>
		<h:body>
			<h:outputStylesheet library="stylesheet" name="theme.css" target="head"/>
			<h:outputScript library="js" name="functions.js" target="head"/>
			<f:loadBundle
				basename="rs.ac.uns.ftn.informatika.bibliography.utils.ResourceBoundles"
				var="messages" />
			<div id="center">
				<p:spacer
					height="20"
					width="1" 
					/>
				<div id="pleaseWait" class="transparent"></div>
				<div id="progressBar" class="progressbar"><h:graphicImage
					library="img" name="progressbar.gif"></h:graphicImage></div>
				<p:ajaxStatus for="form_region" onstart="onStart()" oncomplete="onStop()"/>
				<p:fragment id="form_region">
					<h:form id="evaluationJournalTableForm">
						<h:panelGrid id="mainPanel" 
						 	styleClass="width100">
							<p:inputText id="general" rendered="false" value="" />
							<p:outputPanel ajaxRendered="true">
								<p:message
									for="general"
									errorClass="errorMessage"
									infoClass="infoMessage"
									warnClass="warnMessage"
									fatalClass="fatalMessage"/>
							</p:outputPanel>
							
							<p:panel id="evaluationJournalPanel"
							styleClass="width80">
								<f:facet name="header">		
									<h:outputText value="#{messages['evaluation.mainPanel.journalPanel.header']}" />
								</f:facet>
								<h:panelGrid id="journalSelection" columns="2" rendered="true" columnClasses="width15, width85" width="100%">
	            					
									<p:outputPanel ajaxRendered="true">
										<mytags:outputLabel 
											value="#{messages['evaluation.mainPanel.journalSelection.journalISSN']}: " 
											for="ISSN" 
											errorStyleClass="errorMessage"
											/>
									</p:outputPanel>
									<p:autoComplete
											id="ISSN"
											value="#{evaluationJournalManagedBean.selectedJournal}"
											completeMethod="#{journalManagedBean.autocompleteISSNOrName}"
											var="_journalRow"
											itemLabel="#{_journalRow.toString()}"
											itemValue="#{_journalRow}"
											minQueryLength="3"
											autoSelection="false"
											autocomplete="false"
											styleClass="width80"
											converter="journalConverter"
											forceSelection="true"
									/>
								</h:panelGrid>
						 	</p:panel>
						 	
						 	<p:panel id="evaluationYearCommissionPanel"
						 		styleClass="width80">
						 		<f:facet name="header">
										<h:outputText value="#{messages['evaluation.mainPanel.yearCommissionPanel.header']}" />
								</f:facet>
								
						 		<h:panelGrid id="yearCommissionSelection" columns="4" rendered="true" columnClasses="width10, width40, width10, width40" width="100%">
						 			
						 				<mytags:outputLabel 
											value="#{messages['evaluation.mainPanel.yearCommissionSelection.year']}: " 
											for="year" 
											errorStyleClass="errorMessage"
											/>
										<p:inputText id="year" value="#{evaluationJournalManagedBean.year}">
											<f:validateLongRange minimum="#{evaluationJournalManagedBean.minEvaluationYear}" maximum="#{evaluationJournalManagedBean.maxEvaluationYear}"/>
											<p:clientValidator />
										</p:inputText>
										<p:outputPanel ajaxRendered="true">
											<p:message
												for="year" 
												errorClass="errorMessage"
												infoClass="infoMessage"
												warnClass="warnMessage"
												fatalClass="fatalMessage" />
										</p:outputPanel>
						 			
						 				<h:outputText value="" />
						 			
						 			
						 				<mytags:outputLabel 
											value="#{messages['evaluation.mainPanel.yearCommissionSelection.commission']}: " 
											for="commission" 
											errorStyleClass="errorMessage"
											/>
										
										<p:selectOneMenu id="commission" value="#{evaluationJournalManagedBean.commissionID}" onchange="jsSetRulebook()">
											<f:selectItems value="#{evaluationJournalManagedBean.allCommissions}"/>
										</p:selectOneMenu>

						 				<mytags:outputLabel 
											value=" #{messages['evaluation.mainPanel.yearCommissionSelection.fullText']}: " 
											for="rulebookPng" 
											errorStyleClass="errorMessage"
											/>
											
										<p:commandLink
											title="#{evaluationJournalManagedBean.pdfUrl}"
											target="_blank" 
											rendered="#{not empty evaluationJournalManagedBean.commissionID}">
											<h:graphicImage library="img" name="download32.png" id="rulebookPng" alt="none"/>
										</p:commandLink>
										<h:graphicImage library="img" name="download32.png" id="rulebookPng1" alt="none" rendered="#{empty evaluationJournalManagedBean.commissionID}"/>

										<h:outputText value="" />
										<h:outputText value="" />
										<h:outputText value="" />
										
							 			<p:commandButton ajax="false"
							 				value="#{messages['evaluation.mainPanel.yearCommissionSelection.btnEvaluate']}"
							 				action="#{evaluationJournalManagedBean.evaluateSelectedJournalForCommissionAndYear()}"
														 update="evaluationEvaluationResultsPanel"
							 				  >
								        </p:commandButton>
							        
							        	<p:remoteCommand
												name="jsSetRulebook"
												update="mainPanel"
												action="#{evaluationJournalManagedBean.setCommissionRuleBook}" 
												>
										</p:remoteCommand>
							        			 			
						 		</h:panelGrid>
						 	
						 	</p:panel>
						 	
						 	<p:panel id="evaluationEvaluationResultsPanel"
						 		styleClass="width80" 
						 		rendered="true">
						 		<f:facet name="header">
										<h:outputText value="#{messages['evaluation.mainPanel.evaluationResultsPanel.header']}" />
								</f:facet>
								
								<h:panelGrid id="evaluationResults" columns="1" 
									rendered="#{not empty evaluationJournalManagedBean.evaluatedResult}" 
									>
											<h:outputText 
												value="#{evaluationJournalManagedBean.selectedJournalHeader}" 
												styleClass="evaluationResultsText"/>
											<br/>
											<br/>
											<h:outputText 
												escape="false"
												value="#{evaluationJournalManagedBean.evaluatedResultHeader}" 
												styleClass="evaluationResultsText"/>
											<br/>
											<h:outputText
												escape="false"
												rendered="#{not empty evaluationJournalManagedBean.evaluatedResult.impactFactor}" 
												value="#{evaluationJournalManagedBean.evaluatedResultAsString}" 
												styleClass="evaluationResultsText"/>
											<br/>
											<br/>	
											<h:outputText
												escape="false"
												rendered="#{(not empty evaluationJournalManagedBean.evaluatedResult.impactFactor) and (not evaluationJournalManagedBean.showAllImpactFactors)}" 
												value="#{messages['evaluation.mainPanel.evaluationResultsPanel.evaluatedResult.bibliometricIndicators']}" 
												styleClass="evaluationResultsText"/>
											<h:outputText
												escape="false"
												rendered="#{(not empty evaluationJournalManagedBean.allImpactFactors) and (evaluationJournalManagedBean.showAllImpactFactors)}" 
												value="#{messages['evaluation.mainPanel.evaluationResultsPanel.evaluatedResult.allYearsImpactFactor']}" 
												styleClass="evaluationResultsText"/>
											<p:panel id="scrollableBody"
													styleClass="scrollableBody"
													style="width:800px !important">
												<p:dataTable var="listVarTabel1"
										            	value="#{evaluationJournalManagedBean.evaluatedResultsImpactFactorsWithCategoriesTwoYears}"
										            	rowIndexVar="rowNumber"
										            	rendered="#{((not empty evaluationJournalManagedBean.evaluatedResult.impactFactor) and (not evaluationJournalManagedBean.showAllImpactFactors)) or ((not empty evaluationJournalManagedBean.allImpactFactors) and (evaluationJournalManagedBean.showAllImpactFactors))}"
															 styleClass="stable noHeader"
															 tableStyle="width:auto"
										            	>
														<c:forEach items="#{evaluationJournalManagedBean.evaluatedResultsImpactFactorsWithCategoriesItemPropertyNamesTwoYears}" var="itemPropertyName">
													        <p:column style="#{(rowNumber == 0) ? 'background-color: #DCF0F7 !important;' : 'background-color: #F5F5F5 !important;'}">
													        	<p:commandLink ajax="false"
													        		action="#{evaluationJournalManagedBean.setYearString(listVarTabel1[itemPropertyName])}"
													        		value="#{listVarTabel1[itemPropertyName]}"
													        		rendered="#{rowNumber == 0}"/>
													        	<h:outputText 
													        		value="#{listVarTabel1[itemPropertyName]}" 
													        		rendered="#{rowNumber != 0}"/>

													        </p:column>
													    </c:forEach>
												</p:dataTable>
											</p:panel>
									        
									        <br/>

											<p:panel id="scrollableBody2"
														styleClass="scrollableBody"
														style="width:800px !important">
												<p:dataTable var="listVarTabel2"
																value="#{evaluationJournalManagedBean.evaluatedResultsImpactFactorsWithCategoriesFiveYears}"
															 	rowIndexVar="rowNumber"
																rendered="#{((not empty evaluationJournalManagedBean.evaluatedResult.impactFactor) and (not evaluationJournalManagedBean.showAllImpactFactors)) or ((not empty evaluationJournalManagedBean.allImpactFactors) and (evaluationJournalManagedBean.showAllImpactFactors))}"
															 	styleClass="stable noHeader"
																 tableStyle="width:auto"
												>
													<c:forEach items="#{evaluationJournalManagedBean.evaluatedResultsImpactFactorsWithCategoriesItemPropertyNamesFiveYears}" var="itemPropertyName2">
														<p:column style="#{(rowNumber == 0) ? 'background-color: #DCF0F7 !important;' : 'background-color: #F5F5F5 !important;'}">
															<p:commandLink ajax="false"
																	action="#{evaluationJournalManagedBean.setYearString(listVarTabel2[itemPropertyName2])}"
																	value="#{listVarTabel2[itemPropertyName2]}"
																	rendered="#{rowNumber == 0}"/>
															<h:outputText
																	value="#{listVarTabel2[itemPropertyName2]}"
																	rendered="#{rowNumber != 0}"/>
														</p:column>
													</c:forEach>
												</p:dataTable>
											</p:panel>

											<br/>
											<h:outputText
													escape="false"
													rendered="#{((not empty evaluationJournalManagedBean.evaluatedResult.impactFactor) and (not evaluationJournalManagedBean.showAllImpactFactors)) or ((not empty evaluationJournalManagedBean.allImpactFactors) and (evaluationJournalManagedBean.showAllImpactFactors))}"
													value="#{messages['evaluation.mainPanel.evaluationResultsPanel.evaluatedResult.clickOnYear']}" 
													styleClass="evaluationResultsText"/>
											<br/>
											<h:panelGroup>
												<h:outputText
													escape="false"
													rendered="#{(not empty evaluationJournalManagedBean.allImpactFactors) and (not evaluationJournalManagedBean.showAllImpactFactors)}" 
													value="#{messages['evaluation.mainPanel.evaluationResultsPanel.evaluatedResult.allYearsImpactFactor']}" 
													styleClass="evaluationResultsText"/>
										        <p:commandLink ajax="false"
										        		rendered="#{(not empty evaluationJournalManagedBean.allImpactFactors) and (not evaluationJournalManagedBean.showAllImpactFactors)}" 
														action="#{evaluationJournalManagedBean.impactFactorsForAllYears()}" 
										        		value="link"
										        		styleClass="evaluationResultsText" 
										        		/> 
									        
										        <h:outputText
													escape="false"
													rendered="#{(not empty evaluationJournalManagedBean.evaluatedResult.impactFactor) and (evaluationJournalManagedBean.showAllImpactFactors)}" 
													value="#{messages['evaluation.mainPanel.evaluationResultsPanel.evaluatedResult.bibliometricIndicatorsBack']}" 
													styleClass="evaluationResultsText"/>
										        <p:commandLink ajax="false"
										        		rendered="#{(not empty evaluationJournalManagedBean.evaluatedResult.impactFactor) and (evaluationJournalManagedBean.showAllImpactFactors)}" 
														action="#{evaluationJournalManagedBean.evaluateSelectedJournalForCommissionAndYear()}" 
										        		value="link" 
										        		styleClass="evaluationResultsText"
										        		/>
										   </h:panelGroup>
										<br/>
										<br/>
								</h:panelGrid>
						 	</p:panel>
						</h:panelGrid>
					</h:form>
				</p:fragment>
			</div>
			<p:spacer
				height="70"
				width="1"/>
			<div id="footer">
    			<ui:insert name="footer">
					<ui:include src="../footer.xhtml"/>
				</ui:insert>
			</div>
		</h:body>
	</f:view>
</html>
