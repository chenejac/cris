<ui:composition xmlns="http://www.w3.org/1999/xhtml"
     xmlns:ui="http://java.sun.com/jsf/facelets"
     xmlns:h="http://java.sun.com/jsf/html"
     xmlns:f="http://java.sun.com/jsf/core"
     xmlns:p="http://primefaces.org/ui"
     xmlns:mytags="http://dragan.tmd.uns.ac.rs/mytags">

	<h:panelGrid id="importWizardFormPanel">
		<p:inputText id="general" rendered="false" value="" />
		<p:outputPanel ajaxRendered="true">
			<p:message
				for="general"
				errorClass="errorMessage"
				infoClass="infoMessage"
				warnClass="warnMessage"
				fatalClass="fatalMessage"/>
		</p:outputPanel>
		<p:outputPanel ajaxRendered="true">
			<h:panelGrid columns="1">
				<p:dataTable
					id="publicationTable"
					rendered="#{not empty importManagedBean.nextPublication}"
					value="#{importManagedBean.nextPublication}"
					var="publicationRecordsRow" 
					rows="1"
					>
					<p:column>
						<f:facet name="header">
							<h:outputText
								style="font-size:24px" 
								value="#{messages['records.relatedRecords.publicationForImport']}" />
						</f:facet>
						<h:outputText 
							style="font-size:24px" 
							value="#{publicationRecordsRow.stringRepresentation}" />
					</p:column>
				</p:dataTable>
			</h:panelGrid>
		</p:outputPanel>
		<!-- .......Preview.......      
		#{(not empty importManagedBean.selectedRecord) and (not empty importManagedBean.selectedRecord.relatedRecords) and (userManagedBean.privileges[privilegesManagedBean.formImport][privilegesManagedBean.editFullData])}     -->
		<p:panel
			id="recordPreview"
			header="#{messages['records.import.wizardPanel.preview']}"
			 >
			<p:outputPanel ajaxRendered="true">
				<h:panelGrid columns="1">
					<h:outputText
						value="#{importManagedBean.selectedRecord.HTMLRepresentation}"
						rendered="#{not empty importManagedBean.selectedRecord}"
						styleClass="preview" 
						escape="false"/>
					<p:dataTable
						id="recordTable"
						rendered="false"
						value="#{importManagedBean.selectedRecord.relatedRecords}"
						var="relatedRecordsRow" 
						rows="10"
						paginator="true" paginatorPosition="bottom"
						paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
						currentPageReportTemplate="#{userManagedBean.currentPageReportTemplate}"
						rowsPerPageTemplate="#{userManagedBean.rowsPerPageTemplate}"
						>
						<p:column>
							<f:facet name="header">
								<h:outputText
									value="#{messages['records.relatedRecords.recordsForImport']}" />
							</f:facet>
							<h:outputText value="#{relatedRecordsRow.stringRepresentation}" />
						</p:column>
					</p:dataTable>
					<h:outputText
						value="#{messages['records.import.wizardPanel.noMore']}"
						rendered="#{empty importManagedBean.selectedRecord}"
						styleClass="preview" />
				</h:panelGrid>
			</p:outputPanel>
		</p:panel>
		<!--================= Update, Create, Cancel buttons ====================  -->
		<h:panelGrid columns="2">
			<p:commandButton
				rendered="#{(not empty importManagedBean.selectedRecord)}"
				action="#{importManagedBean.switchAppropriateBeanToImportMode}"
				value="#{messages['records.import.wizardPanel.btnImport']}"
				update="#{importManagedBean.formForImport}"
				limitRender="true" 
				execute="@form" />
			<p:commandButton
				rendered="#{(not empty importManagedBean.selectedRecord) }"
				action="#{importManagedBean.skipRecord}"
				onclick="if(!confirmDecisionSkip()) return false"
				value="#{messages['records.import.wizardPanel.btnNext']}"
				update="importWizardModalPanel"
				limitRender="true" 
				execute="@form" />
			<p:commandButton
				rendered="#{(empty importManagedBean.selectedRecord)}"
				action="#{importManagedBean.finishWizard}"
				value="#{messages['records.import.wizardPanel.btnFinish']}"
				update="mainPanel, #{importManagedBean.renderModalPanels}"
				limitRender="true" 
				execute="@this" />
		</h:panelGrid>		
  		<h:panelGrid 
  			columns="2"
  			rendered="#{(userManagedBean.loggedIn) and (userManagedBean.privileges[privilegesManagedBean.formImport][privilegesManagedBean.editFullData])}"
			>	
  			<h:outputText 
  				rendered="#{(not empty importManagedBean.selectedRecord)}"
				value="#{messages['records.import.wizardPanel.automaticStoring']}"/>
			<p:selectBooleanCheckbox
				rendered="#{(not empty importManagedBean.selectedRecord)}"
				value="#{(importManagedBean.automaticImport)}"/>
		</h:panelGrid>
	</h:panelGrid>
</ui:composition>