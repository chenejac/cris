<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
     xmlns:ui="http://java.sun.com/jsf/facelets"
     xmlns:h="http://java.sun.com/jsf/html"
     xmlns:f="http://java.sun.com/jsf/core"
     xmlns:p="http://primefaces.org/ui"
     xmlns:mytags="http://dragan.tmd.uns.ac.rs/mytags"
	 >
	<f:view locale="#{searchManagedBean.language}"
		contentType="text/html; charset=iso-8859-1" 
		beforePhase="#{searchManagedBean.searchPageEnter}">
	<h:head>
			<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
			<meta http-equiv="Refresh" content="#{session.maxInactiveInterval};url=search.jsf" />
			<meta http-equiv="Pragma" content="no-cache"/>
			<meta http-equiv="Expires" content="-1"/>
			<title><ui:insert name="title">CRIS UNS</ui:insert></title>
	</h:head>
	<h:body onload="formId='searchTableForm'; setFocus(); ">
			<h:outputStylesheet library="stylesheet" name="theme.css" target="head"/>
			<h:outputScript library="js" name="functions.js" target="head"/>
			<f:loadBundle
				basename="rs.ac.uns.ftn.informatika.bibliography.utils.ResourceBoundles"
				var="messages" />
			<div id="header">
    			<ui:insert name="header">
    				<ui:include src="./headerSearch.xhtml"/>
    			</ui:insert>
			</div>
			<div id="center">
				<p:spacer
					height="20"
					width="1"
					/>
				<div id="pleaseWait" class="transparent"></div>
				<div id="progressBar" class="progressbar"><h:graphicImage
					library="img" name="progressbar.gif"></h:graphicImage></div>
				<p:ajaxStatus for="form_region" onstart="onStart()" oncomplete="onStop()"/>
				<p:fragment id="form_region">
				<!-- PRETRAGA -->
				
					<!-- MAIN PANEL -->
					<h:panelGrid id="mainPanel">
						<p:panel id="searchPanel"
						header="#{messages['search.searchPanel.header']}">
							<h:form id="searchTableForm">
							<h:panelGrid id="searchTableFormPanel" width="100%">
								<p:inputText id="general" rendered="false" value="" />
								<p:outputPanel ajaxRendered="true">
									<p:message
										for="general"
										errorClass="errorMessage"
										infoClass="infoMessage"
										warnClass="warnMessage"
										fatalClass="fatalMessage"/>
								</p:outputPanel>
								<p:tabView headerAlignment="left" switchType="ajax" id="searchTab">
									<!-- ....... BASIC TAB.......           -->
 									<p:tab title="#{messages['search.searchPanel.publicationTab.label']}" id="publicationTab" >
								    	<h:panelGrid id="panelPublication" columns="1" width="100%">
								        	<p:dataTable
													id="queryTable"
													var="query"
													rowKeyVar="rowKeyVar"
													value="#{searchManagedBean.searchQuerys}"
													columnClasses="width10, width70, width5, width20, width5"
													styleClass="noHeader"
											>
								          		<p:column>
								                    <h:outputText value="#{messages['search.searchPanel.publicationTab.searchFor']}" rendered="#{query.id==0}"/>
													<h:inputHidden value="#{query.operator}" rendered="#{query.id==0}"/>

													<p:selectOneMenu value="#{query.operator}" rendered="#{query.id!=0}" >
												           <f:selectItems value="#{searchManagedBean.searchQueryOperator}"/>
												    </p:selectOneMenu>
								            	</p:column>
												<p:column>
													<p:fragment>
														<p:inputText
																value="#{query.inputQuery}"
																style="width:98% !important"
																rendered="#{ (query.inputQueryType != searchManagedBean.searchQueryTypeString[2]) and (query.inputQueryType != searchManagedBean.searchQueryTypeString[3]) and (query.inputQueryType != searchManagedBean.searchQueryTypeString[7]) and (query.inputQueryType != searchManagedBean.searchQueryTypeString[8]) }">
														</p:inputText>


														<p:autoComplete
																id="author"
																value="#{query.inputQuery}"
																completeMethod="#{authorManagedBean.autocompleteForSearch}"
																var="_authorRow"
																itemLabel="#{_authorRow}"
																itemValue="#{_authorRow}"
																minQueryLength="3"
																autoSelection="false"
																rendered="#{ (query.inputQueryType eq searchManagedBean.searchQueryTypeString[2]) or (query.inputQueryType eq searchManagedBean.searchQueryTypeString[3])}"
																styleClass="width100"
														/>


														<p:autoComplete
																id="journal"
																value="#{query.inputQuery}"
																completeMethod="#{journalManagedBean.autocompleteName}"
																var="_journalRow"
																itemLabel="#{_journalRow}"
																itemValue="#{_journalRow}"
																minQueryLength="3"
																autoSelection="false"
																rendered="#{query.inputQueryType eq searchManagedBean.searchQueryTypeString[8]}"
																styleClass="width100"
														/>

														<p:autoComplete
																id="conference"
																value="#{query.inputQuery}"
																completeMethod="#{conferenceManagedBean.autocompleteForSearch}"
																var="_conferenceRow"
																itemLabel="#{_conferenceRow}"
																itemValue="#{_conferenceRow}"
																minQueryLength="3"
																autoSelection="false"
																rendered="#{query.inputQueryType eq searchManagedBean.searchQueryTypeString[7]}"
																styleClass="width100"
														/>
													</p:fragment>
												</p:column>

								               	<p:column style="text-align:center">
								               			<h:outputText value="#{messages['search.searchPanel.publicationTab.searchIn']}"/>
								               	</p:column>
								               	<p:column style="text-align:center">
								                        <p:selectOneMenu value="#{query.inputQueryType}" valueChangeListener="#{searchManagedBean.switchToPick}"
								                         onchange="jsfSelectItemGlupaFunkcija()">
												            <f:selectItem itemLabel="#{messages['search.searchPanel.publicationTab.searchTypeCh0']}" itemValue="#{searchManagedBean.searchQueryTypeString[0]}"/>
												            <f:selectItem itemLabel="#{messages['search.searchPanel.publicationTab.searchTypeCh1']}" itemValue="#{searchManagedBean.searchQueryTypeString[1]}"/>
												            <f:selectItem itemLabel="#{messages['search.searchPanel.publicationTab.searchTypeCh2']}" itemValue="#{searchManagedBean.searchQueryTypeString[2]}"/>
												            <f:selectItem itemLabel="#{messages['search.searchPanel.publicationTab.searchTypeCh3']}" itemValue="#{searchManagedBean.searchQueryTypeString[3]}"/>
												            <f:selectItem itemLabel="#{messages['search.searchPanel.publicationTab.searchTypeCh4']}" itemValue="#{searchManagedBean.searchQueryTypeString[4]}"/>
												            <f:selectItem itemLabel="#{messages['search.searchPanel.publicationTab.searchTypeCh5']}" itemValue="#{searchManagedBean.searchQueryTypeString[5]}"/>
												            <f:selectItem itemLabel="#{messages['search.searchPanel.publicationTab.searchTypeCh6']}" itemValue="#{searchManagedBean.searchQueryTypeString[6]}"/>
												            <f:selectItem itemLabel="#{messages['search.searchPanel.publicationTab.searchTypeCh7']}" itemValue="#{searchManagedBean.searchQueryTypeString[7]}"/>
												            <f:selectItem itemLabel="#{messages['search.searchPanel.publicationTab.searchTypeCh8']}" itemValue="#{searchManagedBean.searchQueryTypeString[8]}"/>
												    	</p:selectOneMenu>
												    	<p:remoteCommand
																name="jsfSelectItemGlupaFunkcija"
																update="@form"
																/>
								               	</p:column>
								               	<p:column style="text-align:center">
								               			<p:spacer
															height="20"
															width="1"
															rendered="#{query.id==0}"
															/>
								                       <p:commandLink
								                       			rendered="#{query.id!=0}"
																action="#{searchManagedBean.removeQuery}"
																update="@form"
																>
															<h:graphicImage library="img" name="delete16.png"/>
															<f:param name="removedQuery" value="#{query.id}" />
														</p:commandLink>
								               	</p:column>
												<p:columnGroup type="footer">
													<p:row>
								                      	 <p:column colspan="4" style="text-align:left">
															 <f:facet name="footer">
																 <h:outputText value="#{messages['search.searchPanel.publicationTab.fuzzy']}"/>
																 <p:selectBooleanCheckbox label="#{messages['search.searchPanel.publicationTab.fuzzy']}" value="#{searchManagedBean.fuzzy}" />
															 </f:facet>
								                          </p:column>

								                          <p:column colspan="1">
															  <f:facet name="footer">
																	<p:commandLink
																		action="#{searchManagedBean.addQuery}"
																		update="@form"
																		>
																			<h:graphicImage library="img" name="create16.png"/>
																	</p:commandLink>
															  </f:facet>
								                          </p:column>
													</p:row>
								                </p:columnGroup>
								          	</p:dataTable>
								          </h:panelGrid>

								  		<h:panelGrid id="panelPublicationLimit" columns="2" columnClasses="width10, width90">


								  			<h:outputText value="#{messages['search.searchPanel.publicationTab.limitTo']}" styleClass="outputTextAsHeader"/>


								  			<p:spacer
															height="20"
															width="100%"
															/>

								  			<p:spacer
															height="20"
															width="100%"
															/>

								  			<h:panelGrid columns="2" columnClasses="width60, width40" width="100%">
								  				<h:panelGrid columns="1" width="100%">
								  					<h:outputText value="#{messages['search.searchPanel.publicationTab.dateRange']}"/>
								  					<h:panelGrid columns="4" columnClasses="width25, width30,width10, width35" width="100%">
								  						<h:outputText value="#{messages['search.searchPanel.publicationTab.fromDate']}"/>
								  						<p:selectOneMenu value="#{searchManagedBean.fromDate}">
												            <f:selectItem itemLabel="#{messages['search.searchPanel.publicationTab.fromDateCh0']}" itemValue="#{searchManagedBean.searchQueryTypeString[0]}"/>
												            <f:selectItems value="#{searchManagedBean.dateRange}"/>
												    </p:selectOneMenu>
								  						<h:outputText value="#{messages['search.searchPanel.publicationTab.toDate']}"/>
								  						<p:selectOneMenu value="#{searchManagedBean.toDate}">
												            <f:selectItem itemLabel="#{messages['search.searchPanel.publicationTab.toDateCh0']}" itemValue="#{searchManagedBean.searchQueryTypeString[0]}"/>
												            <f:selectItems value="#{searchManagedBean.dateRange}"/>
												    </p:selectOneMenu>
								  					</h:panelGrid>
								  				</h:panelGrid>
								  				<h:panelGrid columns="1" width="100%">
								  					<h:outputText value="#{messages['search.searchPanel.publicationTab.publicationType']}"/>
								  					<p:selectOneMenu value="#{searchManagedBean.publicationType}">
												    <f:selectItem itemLabel="#{messages['search.searchPanel.publicationTab.publicationTypeCh0']}" itemValue="#{searchManagedBean.searchQueryTypeString[0]}"/>
												    <f:selectItem itemLabel="#{messages['search.searchPanel.publicationTab.publicationTypeCh1']}" itemValue="#{searchManagedBean.searchQueryTypeString[1]}"/>
												    <f:selectItem itemLabel="#{messages['search.searchPanel.publicationTab.publicationTypeCh2']}" itemValue="#{searchManagedBean.searchQueryTypeString[2]}"/>
												    <f:selectItem itemLabel="#{messages['search.searchPanel.publicationTab.publicationTypeCh3']}" itemValue="#{searchManagedBean.searchQueryTypeString[3]}"/>
												    <f:selectItem itemLabel="#{messages['search.searchPanel.publicationTab.publicationTypeCh4']}" itemValue="#{searchManagedBean.searchQueryTypeString[4]}"/>
												</p:selectOneMenu>
								  				</h:panelGrid>
								  			</h:panelGrid>

								  			<p:spacer
															height="20"
															width="100%"
															/>

								  			<h:panelGrid columns="1" width="100%">
								  				<h:panelGrid columns="1" width="100%">
								  					<h:outputText value="#{messages['search.searchPanel.publicationTab.affiliation']}"/>
								  					<p:fragment>
								  					<!-- ....... JSP TREE PART.......           -->
								  					<ui:include src="/normativeRecords/institutionOrganizationTree.xhtml"/>
								  					</p:fragment>

								  				</h:panelGrid>
								  			</h:panelGrid>
								  		</h:panelGrid>
								  		<h:panelGrid id="panelPublicationSearch" columns="1" width="100%">
								  			<p:commandButton
												id="btnPublicationFind"
												action="#{searchManagedBean.sendPublicationForCQL}"
												value="#{messages['search.searchPanel.advanceTab.SearchBtn']}"
												update="panelResult"
												oncomplete="element = document.getElementById('panelResult'); if ( element != null) element.scrollIntoView();"
											/>
								  		</h:panelGrid>
								      </p:tab>

<!-- ....... Author TAB.......           -->
									<p:tab title="#{messages['search.searchPanel.authorTab.label']}" id="authorTab">
										<h:panelGrid id="panelAuthor" columns="1" width="100%">
											<h:panelGrid columns="4" width="100%" columnClasses="width5, width40, width5, width50" style="align:left">
												<!-- ....... Author .......           -->
												<p:outputLabel
														value="#{messages['search.searchPanel.authorTab.FirstLastName']}*"
														for="firstLastName"
												/>

												<p:fragment>
													<p:autoComplete
															id="firstLastName"
															value="#{searchManagedBean.firstLastName}"
															completeMethod="#{authorManagedBean.autocompleteForSearch}"
															var="_authorRow"
															itemLabel="#{_authorRow}"
															itemValue="#{_authorRow}"
															minQueryLength="3"
															autoSelection="false"
															styleClass="width100"
													/>
												</p:fragment>

												<p:commandButton
														id="btnAuthorFind"
														action="#{searchManagedBean.btnAuthorFind}"
														value="#{messages['search.searchPanel.AuthorTab.SearchBtn']}"
														update="@form"
														style="align:right"
												/>
												<p:spacer
														height="20"
														width="100%"
												/>
											</h:panelGrid>
											<h:panelGrid columns="1" width="100%">
												<!-- ....... Autor SEARCHED.......           -->

												<h:panelGroup>
													<h2>
														<h:outputText value="#{messages['search.searchPanel.authorTab.AuthorSearchedEmpty']}" rendered="#{(empty searchManagedBean.authorSearched[0]) and (not empty searchManagedBean.firstLastName)}"/>
													</h2>
												</h:panelGroup>

												<p:panel header="#{messages['search.searchPanel.authorTab.AuthorSearched']}" rendered="#{not empty searchManagedBean.authorSearched[0]}">
													<p:dataTable
															var="queryAuthorSearched"
															value="#{searchManagedBean.authorSearched}"
															rendered="#{not empty searchManagedBean.authorSearched[0]}"
															styleClass="stable"
															tableStyle="width:auto" >
														<p:column colspan="1">
															<f:facet name="header">
																<h:outputText value="#{messages['search.searchPanel.authorTab.AuthorDetails']}"/>
															</f:facet>
															<h:outputText value="#{queryAuthorSearched.HTMLRepresentation}" escape="false"/>
														</p:column>
														<p:column colspan="1" >
															<f:facet name="header">
																<h:outputText value="#{messages['search.searchPanel.AuthorTab.AuthorAllPublication']}"/>
															</f:facet>
															<p:commandLink
																	id="linkAuthorAllPublicationFind"
																	action="#{searchManagedBean.linkAuthorDetailsFind}"
																	value="#{messages['search.searchPanel.AuthorTab.Show']}"
																	update="panelResult"
																	oncomplete="element = document.getElementById('panelResult');if ( element != null) element.scrollIntoView();"
																	rendered="true"
																	title="#{messages['search.searchPanel.AuthorTab.AuthorPublication']}">
																<f:param name="queryAuthorID" value="#{queryAuthorSearched.controlNumber}"/>
																<f:param name="queryType" value="#{searchManagedBean.searchQueryTypeString[0]}" />
															</p:commandLink>
																<!-- Ovaj deo je trebao ako smo zeleli da ne prikazujemo one koje nisu sa Departmana za informatiku
                                                                 rendered="#{queryAuthorSearched.organizationUnit.enabledElementForAuthorSearch}"
                                                                 Ova linija je sledila nakon </p:commandLink> da se ispise - umesto linka sa tekstom prikazi
                                                                 <h:outputText value="-" rendered="#{not queryAuthorSearched.organizationUnit.enabledElementForAuthorSearch}"/>
                                                                -->
														</p:column>
														<p:column colspan="1" >
															<f:facet name="header">
																<h:outputText value="#{messages['search.searchPanel.AuthorTab.AuthorJournal']}"/>
															</f:facet>
															<p:commandLink
																	id="linkAuthorJournalFind"
																	action="#{searchManagedBean.linkAuthorDetailsFind}"
																	value="#{messages['search.searchPanel.AuthorTab.Show']}"
																	update="panelResult"
																	oncomplete="element = document.getElementById('panelResult');if ( element != null) element.scrollIntoView();"
																	rendered="true"
																	title="#{messages['search.searchPanel.AuthorTab.AuthorJournal']}">
																<f:param name="queryAuthorID" value="#{queryAuthorSearched.controlNumber}"/>
																<f:param name="queryType" value="#{searchManagedBean.searchQueryTypeString[1]}" />
															</p:commandLink>
															<!-- Ovaj deo je trebao ako smo zeleli da ne prikazujemo one koje nisu sa Departmana za informatiku
                                                              rendered="#{queryAuthorSearched.organizationUnit.enabledElementForAuthorSearch}"
                                                              Ova linija je sledila nakon </p:commandLink> da se ispise - umesto linka sa tekstom prikazi
                                                              <h:outputText value="-" rendered="#{not queryAuthorSearched.organizationUnit.enabledElementForAuthorSearch}"/>
                                                             -->
														</p:column>
														<p:column colspan="1" >
															<f:facet name="header">
																<h:outputText value="#{messages['search.searchPanel.AuthorTab.AuthorProceedings']}"/>
															</f:facet>
															<p:commandLink
																	id="linkAuthorProceedingsFind"
																	action="#{searchManagedBean.linkAuthorDetailsFind}"
																	value="#{messages['search.searchPanel.AuthorTab.Show']}"
																	update="panelResult"
																	oncomplete="element = document.getElementById('panelResult');if ( element != null) element.scrollIntoView();"
																	rendered="true"
																	title="#{messages['search.searchPanel.AuthorTab.AuthorProceedings']}">
																<f:param name="queryAuthorID" value="#{queryAuthorSearched.controlNumber}"/>
																<f:param name="queryType" value="#{searchManagedBean.searchQueryTypeString[2]}" />
															</p:commandLink>
															<!-- Ovaj deo je trebao ako smo zeleli da ne prikazujemo one koje nisu sa Departmana za informatiku
                                                              rendered="#{queryAuthorSearched.organizationUnit.enabledElementForAuthorSearch}"
                                                              Ova linija je sledila nakon </p:commandLink> da se ispise - umesto linka sa tekstom prikazi
                                                              <h:outputText value="-" rendered="#{not queryAuthorSearched.organizationUnit.enabledElementForAuthorSearch}"/>
                                                             -->
														</p:column>
														<p:column colspan="1" >
															<f:facet name="header">
																<h:outputText value="#{messages['search.searchPanel.AuthorTab.AuthorMonograph']}"/>
															</f:facet>
															<p:commandLink
																	id="linkAuthorMonographFind"
																	action="#{searchManagedBean.linkAuthorDetailsFind}"
																	value="#{messages['search.searchPanel.AuthorTab.Show']}"
																	update="panelResult"
																	oncomplete="element = document.getElementById('panelResult');if ( element != null) element.scrollIntoView();"
																	rendered="true"
																	title="#{messages['search.searchPanel.AuthorTab.AuthorMonograph']}">
																<f:param name="queryAuthorID" value="#{queryAuthorSearched.controlNumber}"/>
																<f:param name="queryType" value="#{searchManagedBean.searchQueryTypeString[3]}" />
															</p:commandLink>
															<!-- Ovaj deo je trebao ako smo zeleli da ne prikazujemo one koje nisu sa Departmana za informatiku
                                                              rendered="#{queryAuthorSearched.organizationUnit.enabledElementForAuthorSearch}"
                                                              Ova linija je sledila nakon </p:commandLink> da se ispise - umesto linka sa tekstom prikazi
                                                              <h:outputText value="-" rendered="#{not queryAuthorSearched.organizationUnit.enabledElementForAuthorSearch}"/>
                                                             -->
														</p:column>
														<p:column colspan="1" >
															<f:facet name="header">
																<h:outputText value="#{messages['search.searchPanel.AuthorTab.AuthorTheses']}"/>
															</f:facet>
															<p:commandLink
																	id="linkAuthorThesesFind"
																	action="#{searchManagedBean.linkAuthorDetailsFind}"
																	value="#{messages['search.searchPanel.AuthorTab.Show']}"
																	update="panelResult"
																	oncomplete="element = document.getElementById('panelResult');if ( element != null) element.scrollIntoView();"
																	rendered="true"
																	title="#{messages['search.searchPanel.AuthorTab.AuthorTheses']}">
																<f:param name="queryAuthorID" value="#{queryAuthorSearched.controlNumber}"/>
																<f:param name="queryType" value="#{searchManagedBean.searchQueryTypeString[4]}" />
															</p:commandLink>
															<!-- Ovaj deo je trebao ako smo zeleli da ne prikazujemo one koje nisu sa Departmana za informatiku
                                                              rendered="#{queryAuthorSearched.organizationUnit.enabledElementForAuthorSearch}"
                                                              Ova linija je sledila nakon </p:commandLink> da se ispise - umesto linka sa tekstom prikazi
                                                              <h:outputText value="-" rendered="#{not queryAuthorSearched.organizationUnit.enabledElementForAuthorSearch}"/>
                                                             -->
														</p:column>
													</p:dataTable>
												</p:panel>
												<!-- ....... Autor DETAILS......     u planu      -->
											</h:panelGrid>
										</h:panelGrid>
									</p:tab>
									<!--  ....... ADVANCE TAB.......           -->
									<p:tab title="#{messages['search.searchPanel.advanceTab.label']}" id="advanceTab" >
										<h:panelGrid id="panelAdvance" columns="1" width="100%">
											<h:panelGroup>
												<h2>
													<h:outputText value="#{messages['search.searchPanel.advanceTab.CQLSearchLabel']}" />
												</h2>
											</h:panelGroup>
											<p:inputTextarea
													id="advanceQuery"
													onkeydown="keyDownHandler(event, 'searchTableForm:searchTab:btnAdvanceFind')"
													value="#{searchManagedBean.advanceQuery}"
													style="width:90%;"
													rows="5"
											>
											</p:inputTextarea>
											<p:commandButton
													id="btnAdvanceFind"
													action="#{searchManagedBean.advanceQuerySearch}"
													value="#{messages['search.searchPanel.advanceTab.SearchBtn']}"
													update="panelResult"
													oncomplete="element = document.getElementById('panelResult');if ( element != null) element.scrollIntoView();"
													/>
										</h:panelGrid>
									</p:tab>

								</p:tabView>
							</h:panelGrid>
							</h:form>
						</p:panel>
					</h:panelGrid>
					<!-- MODAL PANEL -->
					<h:panelGrid id="panelResult">
					<!-- ....... SEARCH RESULTS.......           -->
								  <p:panel id="panelResultPanel" rendered="#{searchManagedBean.searchResultShow}">
									<h2>
									<p:outputPanel ajaxRendered="true">
										<h:outputText value="#{messages['search.panelResult.CQLResultLabel']}" rendered="#{searchManagedBean.searchResultShow}"/>
									</p:outputPanel>
									</h2>
									<p:spacer
										height="20"
										width="1"
										/>
									<h:panelGrid>
									<h:outputText value="#{searchManagedBean.searchQueryError}" rendered="#{not empty searchManagedBean.searchQueryError}" escape="false"/>
									<h:outputText value="#{messages['search.panelResult.CQLResultNumberLabel']} #{searchManagedBean.recordSize}" rendered="#{empty searchManagedBean.searchQueryError}"/>
									
									<h:form id="panelResultPanelForm" rendered="#{empty searchManagedBean.searchQueryError}">
									    <!--  
									    <h:panelGrid columns="2">
									    <p:outputLabel value="#{messages['search.panelResult.representationStyle.header']}: " />
									    <p:selectOneMenu value="#{searchManagedBean.representationStyle}">
									    	<f:selectItem 
												itemValue="htmlRepresentation"
												itemLabel="#{messages['search.panelResult.representationStyle.htmlRepresentation']}" />
											<f:selectItem 
												itemValue="harvardRepresentation"
												itemLabel="#{messages['search.panelResult.representationStyle.harvardRepresentation']}" />
									    	<p:ajax
									    		event="change" 
									    		render="advanceQueryResultsTable" 
									    		limitRender="true"
									    		execute="@this" />
									    </p:selectOneMenu>
									    </h:panelGrid>
										-->
										
										 
									    <h:panelGrid columns="2">
									    <p:outputLabel value="#{messages['search.panelResult.sortMethod.header']}: " />
									    <p:selectOneMenu value="#{searchManagedBean.sortMethod}">
									    	<f:selectItem 
												itemValue="relevance"
												itemLabel="#{messages['search.panelResult.sortMethod.relevance']}" />
											<f:selectItem 
												itemValue="date"
												itemLabel="#{messages['search.panelResult.sortMethod.date']}" />
									    	<p:ajax
									    		event="change" 
									    		render="advanceQueryResultsTable" 
									    		limitRender="true"
									    		execute="@this" />
									    </p:selectOneMenu>
									    </h:panelGrid>
										
										
										<p:dataTable
											id="advanceQueryResultsTable" 
											var="resultQuery" 
											rowKeyVar="rowKeyVar" 
											value="#{searchManagedBean.records}" 
											rendered="#{empty searchManagedBean.searchQueryError}"
											rows="100" 
											style="width:100% !important;"
											paginator="true" paginatorPosition="bottom"
											paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
											currentPageReportTemplate="#{userManagedBean.currentPageReportTemplate}"
											rowsPerPageTemplate="#{userManagedBean.rowsPerPageTemplate}"
										>
											<p:column>
											<p:commandLink
												id="showDetails"
												onclick="if(document.getElementById(this.id.replace('showDetails', 'details')).style.display=='none') document.getElementById(this.id.replace('showDetails', 'details')).style.display='block'; else document.getElementById(this.id.replace('showDetails', 'details')).style.display='none'; return false;">
												<h:graphicImage library="img" name="details.png" />
												<p:tooltip followMouse="true" direction="topRight"
													showDelay="1000" styleClass="tooltip" mode="client">
													<span class="tooltipSpan"> 
														<h:panelGrid columns="2">
															<h:outputText
																value="#{messages['search.panelResult.btnDetails']}" />
														</h:panelGrid> 
													</span>
												</p:tooltip>
											</p:commandLink>
									     		<!--   <h:outputText value="#{resultQuery.harvardRepresentation}" escape="false" rendered="#{(not empty resultQuery) and (searchManagedBean.representationStyle == 'harvardRepresentation')}"/>
									     		<h:outputText value="#{resultQuery.HTMLRepresentation}" escape="false" rendered="#{(not empty resultQuery) and (searchManagedBean.representationStyle == 'htmlRepresentation')}"/> -->
									     		<h:outputText value="#{resultQuery.harvardRepresentation}" escape="false" rendered="#{(not empty resultQuery)}"/>
									        
									        <p:panel
												rendered="true"
												id="details"
												style="display:none"
												>
									     		<p:tabView
									     			dynamic="true"
									     			activeIndex="0"
									     			
									     			>
									     			<p:tab
									     				id="HTMLDataTab" 
									     				title="#{messages['search.panelResult.htmlTab']}" >
									     				<h:outputText value="#{resultQuery.HTMLRepresentation}" escape="false" />
									     			</p:tab>
									     			<p:tab
									     				id="Download"
									     				title="#{messages['search.panelResult.downloadTab']}"
									     				>
									     				<!-- onenter="window.open('#{resultQuery.fileURL}', '_blank');"  -->
									     				<h:outputText 
									     					rendered="#{not (((resultQuery.class.simpleName=='PatentDTO') or (resultQuery.class.simpleName=='ProductDTO') or (resultQuery.class.simpleName=='PaperJournalDTO') or (resultQuery.class.simpleName=='PaperProceedingsDTO') or (resultQuery.class.simpleName=='MonographDTO') or (resultQuery.class.simpleName=='PaperMonographDTO') or (resultQuery.class.simpleName=='StudyFinalDocumentDTO')) and (not empty resultQuery.uri))}"
									     					escape="false" 
									     					value="#{messages['search.panelResult.downloadSolution']}" />
									     				<h:outputLink
															rendered="#{((resultQuery.class.simpleName=='PatentDTO') or (resultQuery.class.simpleName=='ProductDTO') or(resultQuery.class.simpleName=='PaperJournalDTO') or (resultQuery.class.simpleName=='PaperProceedingsDTO') or (resultQuery.class.simpleName=='MonographDTO') or (resultQuery.class.simpleName=='PaperMonographDTO') or (resultQuery.class.simpleName=='StudyFinalDocumentDTO')) and (not empty resultQuery.uri)}"
															value="#{resultQuery.uri}"
															target="_blank"
															>
															<h:graphicImage library="img" name="download.png" width="24" height="24"/>
														</h:outputLink>
									     			</p:tab>
									     			<p:tab
									     				id="MARC21Tab"
									     				title="#{messages['search.panelResult.marc21Tab']}" >
									     				<h:outputText value="#{resultQuery.MARC21}" escape="false" />
									     			</p:tab>
									     			<p:tab
									     				id="DublinCoreTab"
									     				title="#{messages['search.panelResult.dublinCoreTab']}" >
									     				<h:outputText value="#{resultQuery.dublinCore}" escape="false" />
									     			</p:tab>
								     			</p:tabView>
								     		</p:panel>
									        </p:column>
										</p:dataTable>
										<!-- maxPages +1 jer je npr 111 podeljeno 100 = 1 a nama treba 2 strane -->
									
									</h:form>
									</h:panelGrid>
								  </p:panel>
					</h:panelGrid>
				</p:fragment>
			</div>
			<p:spacer
				height="70"
				width="1"/>
			<div id="footer">
    			<ui:insert name="footer">
					<ui:include src="./footer.xhtml"/>
				</ui:insert>
			</div>
	</h:body>
	</f:view>
</html>