<ui:composition xmlns="http://www.w3.org/1999/xhtml"
     xmlns:ui="http://java.sun.com/jsf/facelets"
     xmlns:h="http://java.sun.com/jsf/html"
     xmlns:f="http://java.sun.com/jsf/core"
     xmlns:p="http://primefaces.org/ui"
     xmlns:mytags="http://dragan.tmd.uns.ac.rs/mytags"
     >
     <h:outputStylesheet>
        .wide-panel {
        	margin-left: 1% !important;
			margin-right: 1% !important;
			text-align: left !important; 
			width: 98% !important;
			overflow: auto !important;
		        	        	
        }      
     </h:outputStylesheet>       
    
     
	
    
    <!--=================APV Registered Researcher Short Info ====================  -->
    <p:panel id="apvRegisteredResearcherViewDetailsAuthorPanel" header="#{messages['records.apvRegisteredResearcher.viewDetailsPanel.header']}" styleClass="wide-panel">
		<h:panelGrid columns="2" id="apvRegisteredResearcherShortDetailsPanelGrid" columnClasses="width20, width80" style="align:left" >
    		<h:outputText value="#{messages['records.apvRegisteredResearcher.viewDetails.person.lastname']}"/>
    		<h:outputText value="#{apvRegisteredResearchersManagedBean.selectedAuthor.name.lastname}" style="font-weight:bold"/>
    		<h:outputText value="#{messages['records.apvRegisteredResearcher.viewDetails.person.firstname']}"/>
    		<h:outputText value="#{apvRegisteredResearchersManagedBean.selectedAuthor.name.firstname}" style="font-weight:bold"/>
    		<h:outputText value="#{messages['records.apvRegisteredResearcher.viewDetails.person.organisation']}"/>
    		<h:outputText value="#{apvRegisteredResearchersManagedBean.selectedAuthor.institutionName}" style="font-weight:bold"/>	 
    		<h:outputText value="#{messages['records.apvRegisteredResearcher.viewDetails.person.APVNTnumber']}"/>
    		<h:outputText value="#{apvRegisteredResearchersManagedBean.selectedAuthor.apvnt}" style="font-weight:bold"/>	 
	 		<h:outputText value="#{messages['records.apvRegisteredResearcher.viewDetails.person.commisionFreeText']}"/>    	
    		<h:outputText value="#{apvRegisteredResearchersManagedBean.selectedAuthorOrgUnit.someName}"/>
    		<h:outputText value="#{messages['records.apvRegisteredResearcher.viewDetails.person.usedRuleBook']}"/>
    		<h:outputLink 
				value="#{apvRegisteredResearchersManagedBean.pdfUrl}"
				target="_blank" 
				rendered="#{not empty apvRegisteredResearchersManagedBean.pdfUrl}">
				<h:graphicImage library="img" name="download16.png" alt="none"/>
			</h:outputLink>	
			<h:graphicImage library="img" name="download16.png"  alt="none" rendered="#{empty apvRegisteredResearchersManagedBean.pdfUrl}"/>
    				
    	</h:panelGrid>
    	<h:panelGrid columns="1">
			<h:panelGrid columns="6" columnClasses="width10, width10,width10, width10, width20, width20" width="100%">
				<h:outputText value="#{messages['records.apvRegisteredResearcher.viewDetails.fromDate']}"/>
				<p:selectOneMenu value="#{apvRegisteredResearchersManagedBean.fromDate}">
            		<f:selectItem itemLabel="#{messages['records.apvRegisteredResearcher.viewDetails.fromDateCh0']}" itemValue="#{searchManagedBean.searchQueryTypeString[0]}"/>
            		<f:selectItems value="#{searchManagedBean.dateRange}"/>
    			</p:selectOneMenu>
				<h:outputText value="#{messages['records.apvRegisteredResearcher.viewDetails.toDate']}"/>
				<p:selectOneMenu value="#{apvRegisteredResearchersManagedBean.toDate}">
            		<f:selectItem itemLabel="#{messages['records.apvRegisteredResearcher.viewDetails.toDateCh0']}" itemValue="#{searchManagedBean.searchQueryTypeString[0]}"/>
            		<f:selectItems value="#{searchManagedBean.dateRange}"/>
    			</p:selectOneMenu>
				<p:commandButton ajax="false"action="#{apvRegisteredResearchersManagedBean.calculateAgain}" value="#{messages['records.apvRegisteredResearcher.viewDetails.btnCalculateAgain']}" />
				<p:commandButton
					action="#{apvRegisteredResearchersManagedBean.prepareReportGeneration}" 
					value="#{messages['records.apvRegisteredResearcher.viewDetails.btnPrepareReportGeneration']}" 
					render="reportPublicationsEditModalPanel"
					execute="@this" 
					limitRender="true"/>
			</h:panelGrid>
		</h:panelGrid>
    	<br/>
     	
     	<p:dataTable value="#{apvRegisteredResearchersManagedBean.selectedAuthorKNR.resultsGroups}" var="list" id="expandableTable" styleClass="wide-panel">
     		<f:facet name="header">  
                <p:columnGroup>
                    <p:column colspan="4">
                        <h:outputText value="#{messages['records.apvRegisteredResearcher.viewDetails.productionTable.summary']}" />
                    </p:column>
                    <p:column breakRowBefore="true">
                        <h:outputText value="#{messages['records.apvRegisteredResearcher.viewDetails.productionTable.resultType']}" />
                    </p:column>
                    <p:column>
                        <h:outputText value="#{messages['records.apvRegisteredResearcher.viewDetails.productionTable.resultName']}" />
                    </p:column>
                    <p:column>
                        <h:outputText value="#{messages['records.apvRegisteredResearcher.viewDetails.productionTable.count']}" />
                    </p:column>
                    <p:column>
                        <h:outputText value="#{messages['records.apvRegisteredResearcher.viewDetails.productionTable.points']}" />
                    </p:column>
                  </p:columnGroup>
                  </f:facet>
                    <p:column>
                		<h:outputText value="#{list.resultType.classId}" />
            		</p:column>
            		<p:column style="width:80%">
            		<p:outputPanel ajaxRendered="true" >
            			<p:commandLink id="link" value="#{list.resultType.someTerm}" render="collapsablePanel" execute="@this">
	 						<f:param name="val" value="#{!apvRegisteredResearchersManagedBean.showList[list.resultType.classId]}" assignTo="#{apvRegisteredResearchersManagedBean.showList[list.resultType.classId]}" />
	 					</p:commandLink>
	 					 <p:fragment id="collapsablePanel">
					     <p:dataList value="#{list.results}" var="item" rendered="#{apvRegisteredResearchersManagedBean.showList[list.resultType.classId]}" type="unordered">
					     <div style="margin-bottom: 10px;">	
					     	<h:outputText value="#{item.publication.harvardRepresentation}" rendred="true" escape="false"  />
					     </div>						     	
					     </p:dataList>
					     <p:commandLink render="collapsablePanel" execute="@this" rendered="#{apvRegisteredResearchersManagedBean.showList[list.resultType.classId]}">
					     	<h:graphicImage library="img" name="backKNRPublic.gif" style="float:right;" />
	 						<f:param name="val" value="#{!apvRegisteredResearchersManagedBean.showList[list.resultType.classId]}" assignTo="#{apvRegisteredResearchersManagedBean.showList[list.resultType.classId]}" />
	 					</p:commandLink>
					   </p:fragment>
					</p:outputPanel >
            		</p:column>
            		<p:column style="text-align: center;">
                		<h:outputText value="#{list.results.size()}" />
                		<f:facet name="footer"><h:outputText value="#{apvRegisteredResearchersManagedBean.selectedAuthorKNR.totalPapers}"/></f:facet>
            		</p:column>
            		<p:column style="text-align: center;">
                		<h:outputText value="#{list.quantitativeMeasure.doubleValue()*list.results.size()}" > 
                			<f:convertNumber maxFractionDigits="1" />
                		</h:outputText>
                		<f:facet name="footer"><h:outputText value="#{apvRegisteredResearchersManagedBean.selectedAuthorKNR.totalPoints}"/></f:facet>	                       
            		</p:column>
     	</p:dataTable>
     </p:panel>
     
	<!--=================Back buttons ====================  -->
		<h:panelGrid columns="1">
			<p:commandButton
				rendered="#{(apvRegisteredResearchersManagedBean.editMode == modesManagedBean.viewDetails)}"
				action="#{apvRegisteredResearchersManagedBean.switchToBrowseMode}"
				value="#{messages['records.apvRegisteredResearchers.backButton']}"
				render="mainPanel apvRegisteredResearcherViewDetailsModalPanel"
				limitRender="true" 
				execute="@form" />
		</h:panelGrid>
		
	
	

</ui:composition>     