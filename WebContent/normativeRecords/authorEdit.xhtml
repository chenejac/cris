<ui:composition xmlns="http://www.w3.org/1999/xhtml"
     xmlns:ui="http://java.sun.com/jsf/facelets"
     xmlns:h="http://java.sun.com/jsf/html"
     xmlns:f="http://java.sun.com/jsf/core"
     xmlns:p="http://primefaces.org/ui"
     xmlns:mytags="http://dragan.tmd.uns.ac.rs/mytags">

	<h:panelGrid id="authorEditFormPanel">
		<p:inputText id="general" rendered="false" value="" />
		<p:outputPanel ajaxRendered="true">
			<p:message
				for="general"
				errorClass="errorMessage"
				infoClass="infoMessage"
				warnClass="warnMessage"
				fatalClass="fatalMessage"/>
		</p:outputPanel>
		<!-- .......Author.......           -->
		<p:panel id="authorPreview"
			header="#{messages['records.author.editPanel.preview']}"
			rendered="#{authorManagedBean.editTabNumber == 2}" >
			<p:outputPanel ajaxRendered="true">
				<h:panelGrid columns="1">
					<h:outputText value="#{(authorManagedBean.selectedAuthor)}"
						styleClass="preview" />
				</h:panelGrid>
			</p:outputPanel>
		</p:panel>
		<p:panel
			id="scrollableBody" 
			rendered="#{authorManagedBean.editTabNumber lt 2}"
			styleClass="scrollableBody"	>
			<p:panel id="authorFullPreview"
				header="#{messages['records.author.editPanel.preview']}"
				rendered="#{(authorManagedBean.editMode == modesManagedBean.import) and (authorManagedBean.editTabNumber == 1)}">
				<p:outputPanel ajaxRendered="true">
					<h:panelGrid columns="1">
						<h:outputText
							value="#{authorManagedBean.selectedAuthor.HTMLRepresentation}"
							styleClass="preview" 
							escape="false"/>
					</h:panelGrid>
				</p:outputPanel>
				<p:commandLink
					render="relatedRecordsEditModalPanel"
				    execute="@this" 
				    limitRender="true">
				    <h:graphicImage library="img" name="publications.png" />
				    <f:setPropertyActionListener target="#{relatedRecordsManagedBean.selectedRecord}"
				        value="#{authorManagedBean.selectedAuthor}" />
				    <p:tooltip followMouse="true" direction="topRight"
						showDelay="1000" styleClass="tooltip" mode="client">
						<span class="tooltipSpan"> 
							<h:panelGrid columns="2">
								<h:graphicImage library="img" name="publicationsToolTip.png" />
								<h:outputText
									value="#{messages['records.author.tablePanel.btnPublications']}" />
							</h:panelGrid> 
						</span>
					</p:tooltip>
				</p:commandLink>
			</p:panel>
			<p:tabView
				switchType="#{(authorManagedBean.editMode == modesManagedBean.viewDetails)?'client':'ajax'}" 
				activeItem="#{authorManagedBean.activeEditTab}" >
				<p:tab
					name="tab0"
					header="#{messages['records.author.editPanel.firstTab']}"
					rendered="#{authorManagedBean.editTabNumber == 0}">
					<!-- ===========================   tablePanel  ============================= -->
					<p:outputPanel ajaxRendered="true">
						<h:panelGrid columns="2"
							rendered="#{(authorManagedBean.pleaseInstitution) and (authorManagedBean.editMode == modesManagedBean.update)}" >
							<h:outputText value="#{authorManagedBean.pleaseInstitutionMessage}"
								styleClass="rf-msg-inf" />
						</h:panelGrid>
						<!-- <h:panelGrid columns="2"
							rendered="#{(not empty authorManagedBean.otherName)}" >
							<h:outputText value="#{messages['records.author.editPanel.pleaseOtherName']}"
								styleClass="rf-msg-inf" />
						</h:panelGrid> -->
					</p:outputPanel>
					<p:panel id="authorNameTablePanel"
						header="#{messages['records.author.editPanel.nameTablePanel.header']}"
						rendered="#{(authorManagedBean.editMode == modesManagedBean.viewDetails) or (authorManagedBean.editMode == modesManagedBean.import)}">
						<p:dataTable id="authorNameTable"
							value="#{authorManagedBean.selectedAuthor.allNames}"
							var="authorNameRow">
							<!--     ........  name   .......-->
							<p:column>
								<f:facet name="header">
									<h:outputText
										value="#{messages['records.author.editPanel.nameTablePanel.name']}" />
								</f:facet>
								<h:outputText value="#{authorNameRow}" />
							</p:column>
							<!--     ........  change position   .......-->
						<p:column rendered="#{(authorManagedBean.editMode != modesManagedBean.viewDetails)}">
							<f:facet name="header">
								<h:outputText
									value="#{messages['records.author.editPanel.nameTablePanel.changePosition']}" />
							</f:facet>
							<p:commandLink action="#{authorManagedBean.moveAuthorNameUp}"
								render="authorNameTable"
								limitRender="true"
								execute="@this">
								<h:graphicImage library="img" name="up.gif" />
								<f:param name="firstname" value="#{authorNameRow.firstname}" />
								<f:param name="lastname" value="#{authorNameRow.lastname}" />
							</p:commandLink>
							<p:commandLink action="#{authorManagedBean.moveAuthorNameDown}"
								render="authorNameTable"
								limitRender="true"
								execute="@this">
								<h:graphicImage library="img" name="down.gif" />
								<f:param name="firstname" value="#{authorNameRow.firstname}" />
								<f:param name="lastname" value="#{authorNameRow.lastname}" />
							</p:commandLink>
						</p:column>
						<!--     ........  remove name   .......-->
						<p:column rendered="#{(authorManagedBean.editMode != modesManagedBean.viewDetails)}">
							<f:facet name="header">
								<h:outputText
									value="#{messages['records.author.editPanel.nameTablePanel.remove']}" />
							</f:facet>
							<p:commandLink action="#{authorManagedBean.removeAuthorName}"
								render="authorNameTable"
								immediate="true"
								limitRender="true"
								execute="@this"
								rendered="#{authorNameRow != authorManagedBean.selectedAuthor.name}">
								<h:graphicImage library="img" name="delete.png" />
								<f:param name="firstname" value="#{authorNameRow.firstname}" />
								<f:param name="lastname" value="#{authorNameRow.lastname}" />
							</p:commandLink>
						</p:column>
						</p:dataTable>
						<p:spacer
							height="20"
							width="1"
							/>
					</p:panel>
					<h:panelGrid 
						columns="5" 
						columnClasses="width20, width30, width10, width10, width30">
						<!-- ....... Lastname other format.......           -->
						<p:outputPanel
							rendered="#{authorManagedBean.editMode == modesManagedBean.import}"
							ajaxRendered="true">
							<mytags:outputLabel 
								value="#{messages['records.author.editPanel.lastname']}*" 
								for="lastnameOtherFormat" 
								errorStyleClass="errorMessage"
								/>
						</p:outputPanel>
						<p:inputText
							id="lastnameOtherFormat"
							rendered="#{authorManagedBean.editMode == modesManagedBean.import}"
							value="#{authorManagedBean.lastnameOtherFormat}" 
							maxlength="100" 
							required="false" />
						<h:outputText 
							rendered="#{authorManagedBean.editMode == modesManagedBean.import}"
							value=""  
							/>
						<h:outputText 
							rendered="#{authorManagedBean.editMode == modesManagedBean.import}"
							value=""  
							/>
						<p:outputPanel
							rendered="#{authorManagedBean.editMode == modesManagedBean.import}"
							ajaxRendered="true" 
							>
							<p:message
								for="lastnameOtherFormat" 
								errorClass="errorMessage"
								infoClass="infoMessage"
								warnClass="warnMessage"
								fatalClass="fatalMessage" />
						</p:outputPanel>
						<p:outputPanel
							rendered="#{authorManagedBean.editMode == modesManagedBean.import}"
							ajaxRendered="true">
							<mytags:outputLabel 
								value="#{messages['records.author.editPanel.firstname']}*" 
								for="firstnameOtherFormat" 
								errorStyleClass="errorMessage"
								/>
						</p:outputPanel>
						<p:inputText
							id="firstnameOtherFormat"
							rendered="#{authorManagedBean.editMode == modesManagedBean.import}"
							value="#{authorManagedBean.firstnameOtherFormat}" 
							maxlength="100" 
							required="false"
							/>
						<p:commandButton
							rendered="#{authorManagedBean.editMode == modesManagedBean.import}"
							action="#{authorManagedBean.addAuthorName}"
							value="#{messages['records.author.editPanel.btnAddName']}"
							render="authorNameTablePanel" 
							execute="lastnameOtherFormat, firstnameOtherFormat" />
						<h:outputText 
							rendered="#{authorManagedBean.editMode == modesManagedBean.import}"
							value="" 
							/>
						<p:outputPanel
							rendered="#{authorManagedBean.editMode == modesManagedBean.import}"
							ajaxRendered="true" 
							>
							<p:message
								for="firstnameOtherFormat" 
								errorClass="errorMessage"
								infoClass="infoMessage"
								warnClass="warnMessage"
								fatalClass="fatalMessage" />
						</p:outputPanel>
						
						
						
						<!-- ....... Lastname .......           -->
						<p:outputPanel
							rendered="#{(authorManagedBean.editMode == modesManagedBean.add) or (authorManagedBean.editMode == modesManagedBean.update)}"
							ajaxRendered="true">
							<mytags:outputLabel 
								value="#{messages['records.author.editPanel.lastname']}*" 
								for="lastname" 
								errorStyleClass="errorMessage"
								/>
						</p:outputPanel>
						<p:inputText
							id="lastname"
							rendered="#{(authorManagedBean.editMode == modesManagedBean.add) or (authorManagedBean.editMode == modesManagedBean.update)}"
							readonly="#{authorManagedBean.editMode == modesManagedBean.update}"
							value="#{authorManagedBean.selectedAuthor.name.lastname}" 
							maxlength="100" 
							required="true" />
						<h:outputText 
							rendered="#{(authorManagedBean.editMode == modesManagedBean.add) or (authorManagedBean.editMode == modesManagedBean.update)}"
							value=""  
							/>
						<h:outputText 
							rendered="#{(authorManagedBean.editMode == modesManagedBean.add) or (authorManagedBean.editMode == modesManagedBean.update)}"
							value=""  
							/>
						<p:outputPanel
							rendered="#{(authorManagedBean.editMode == modesManagedBean.add) or (authorManagedBean.editMode == modesManagedBean.update)}"
							ajaxRendered="true" 
							>
							<p:message
								for="lastname" 
								errorClass="errorMessage"
								infoClass="infoMessage"
								warnClass="warnMessage"
								fatalClass="fatalMessage" />
						</p:outputPanel>
						<!--    Firstname 			-->
						<p:outputPanel
							rendered="#{(authorManagedBean.editMode == modesManagedBean.add) or (authorManagedBean.editMode == modesManagedBean.update)}"
							ajaxRendered="true">
							<mytags:outputLabel 
								value="#{messages['records.author.editPanel.firstname']}*" 
								for="firstname" 
								errorStyleClass="errorMessage"
								/>
						</p:outputPanel>
						<p:inputText
							id="firstname"
							rendered="#{(authorManagedBean.editMode == modesManagedBean.add) or (authorManagedBean.editMode == modesManagedBean.update)}"
							readonly="#{authorManagedBean.editMode == modesManagedBean.update}"
							value="#{authorManagedBean.selectedAuthor.name.firstname}" 
							maxlength="100" 
							required="true"
							/>
						<h:outputText 
							rendered="#{(authorManagedBean.editMode == modesManagedBean.add) or (authorManagedBean.editMode == modesManagedBean.update)}"
							value=""  
							/>
						<h:outputText 
							rendered="#{(authorManagedBean.editMode == modesManagedBean.add) or (authorManagedBean.editMode == modesManagedBean.update)}"
							value="" 
							/>
						<p:outputPanel
							rendered="#{(authorManagedBean.editMode == modesManagedBean.add) or (authorManagedBean.editMode == modesManagedBean.update)}"
							ajaxRendered="true" 
							>
							<p:message
								for="firstname" 
								errorClass="errorMessage"
								infoClass="infoMessage"
								warnClass="warnMessage"
								fatalClass="fatalMessage" />
						</p:outputPanel>
						
						<!-- ....... Other name.......           -->
						<p:outputPanel
							rendered="#{((authorManagedBean.editMode == modesManagedBean.add) or (authorManagedBean.editMode == modesManagedBean.update))}"
							ajaxRendered="true">
							<mytags:outputLabel 
								value="#{messages['records.author.editPanel.otherName']}" 
								for="otherName" 
								errorStyleClass="errorMessage"
								/>
						</p:outputPanel>
						<p:inputText
							id="otherName"
							rendered="#{((authorManagedBean.editMode == modesManagedBean.add) or (authorManagedBean.editMode == modesManagedBean.update))}"
							readonly="#{(not userManagedBean.privileges[privilegesManagedBean.formAuthor][privilegesManagedBean.editFullData]) and (not empty authorManagedBean.selectedAuthor.name.otherName)}"
							value="#{authorManagedBean.selectedAuthor.name.otherName}" 
							maxlength="100" 
							/>
						<h:outputText 
							rendered="#{((authorManagedBean.editMode == modesManagedBean.add) or (authorManagedBean.editMode == modesManagedBean.update))}"
							value=""  
							/>
						<h:outputText 
							rendered="#{((authorManagedBean.editMode == modesManagedBean.add) or (authorManagedBean.editMode == modesManagedBean.update))}"
							value="#{messages['records.author.editPanel.otherNameExplanation']}" 
							/>
						<p:outputPanel
							rendered="#{((authorManagedBean.editMode == modesManagedBean.add) or (authorManagedBean.editMode == modesManagedBean.update))}"
							ajaxRendered="true" 
							>
							<p:message
								for="otherName" 
								errorClass="errorMessage"
								infoClass="infoMessage"
								warnClass="warnMessage"
								fatalClass="fatalMessage" />
						</p:outputPanel>
						<!-- ....... Address.......            -->
						<p:outputPanel
							rendered="#{userManagedBean.privileges[privilegesManagedBean.formAuthor][privilegesManagedBean.editFullData]}"
							ajaxRendered="true">
							<mytags:outputLabel 
								value="#{messages['records.author.editPanel.address']}" 
								for="address" 
								errorStyleClass="errorMessage"
								/>
						</p:outputPanel>
						<p:inputText
							id="address"
							rendered="#{userManagedBean.privileges[privilegesManagedBean.formAuthor][privilegesManagedBean.editFullData]}"
							value="#{authorManagedBean.selectedAuthor.address}"
							maxlength="200"  
							readonly="#{(authorManagedBean.editMode == modesManagedBean.viewDetails)}"
							/>
						<h:outputText 
							value=""  
							rendered="#{userManagedBean.privileges[privilegesManagedBean.formAuthor][privilegesManagedBean.editFullData]}"
							/>
						<h:outputText 
							value=""  
							rendered="#{userManagedBean.privileges[privilegesManagedBean.formAuthor][privilegesManagedBean.editFullData]}"
							/>
						<p:outputPanel
							rendered="#{userManagedBean.privileges[privilegesManagedBean.formAuthor][privilegesManagedBean.editFullData]}"
							ajaxRendered="true" 
							>
							<p:message
								for="address" 
								errorClass="errorMessage"
								infoClass="infoMessage"
								warnClass="warnMessage"
								fatalClass="fatalMessage" />
						</p:outputPanel>
						
						<!-- ....... City .......            -->   
						<p:outputPanel
							rendered="#{userManagedBean.privileges[privilegesManagedBean.formAuthor][privilegesManagedBean.editFullData]}"
							ajaxRendered="true">
							<mytags:outputLabel 
								value="#{messages['records.author.editPanel.city']}" 
								for="city" 
								errorStyleClass="errorMessage"
								/>
						</p:outputPanel>
						<p:inputText
							id="city"
							rendered="#{userManagedBean.privileges[privilegesManagedBean.formAuthor][privilegesManagedBean.editFullData]}"
							value="#{authorManagedBean.selectedAuthor.city}"
							maxlength="200"  
							readonly="#{(authorManagedBean.editMode == modesManagedBean.viewDetails)}"
							/>
						<h:outputText 
							value=""  
							rendered="#{userManagedBean.privileges[privilegesManagedBean.formAuthor][privilegesManagedBean.editFullData]}"
							/>
						<h:outputText 
							value=""  
							rendered="#{userManagedBean.privileges[privilegesManagedBean.formAuthor][privilegesManagedBean.editFullData]}"
							/>
						<p:outputPanel
							rendered="#{userManagedBean.privileges[privilegesManagedBean.formAuthor][privilegesManagedBean.editFullData]}"
							ajaxRendered="true" 
							>
							<p:message
								for="city" 
								errorClass="errorMessage"
								infoClass="infoMessage"
								warnClass="warnMessage"
								fatalClass="fatalMessage" />
						</p:outputPanel>
						<!-- ....... Year of birth.......           -->
						<p:outputPanel
							rendered="#{userManagedBean.privileges[privilegesManagedBean.formAuthor][privilegesManagedBean.editFullData]}"
							ajaxRendered="true">
							<mytags:outputLabel 
								value="#{messages['records.author.editPanel.yearOfBirth']}" 
								for="yearOfBirth" 
								errorStyleClass="errorMessage"
								/>
						</p:outputPanel>
						<p:inputText
							id="yearOfBirth"
							rendered="#{userManagedBean.privileges[privilegesManagedBean.formAuthor][privilegesManagedBean.editFullData]}"
							readonly="#{(authorManagedBean.editMode == modesManagedBean.viewDetails)}"
							value="#{authorManagedBean.selectedAuthor.yearOfBirth}"
							maxlength="4"  
							/>
						<h:outputText 
							value=""  
							rendered="#{userManagedBean.privileges[privilegesManagedBean.formAuthor][privilegesManagedBean.editFullData]}"
							/>
						<h:outputText 
							value=""  
							rendered="#{userManagedBean.privileges[privilegesManagedBean.formAuthor][privilegesManagedBean.editFullData]}"
							/>
						<p:outputPanel
							rendered="#{userManagedBean.privileges[privilegesManagedBean.formAuthor][privilegesManagedBean.editFullData]}"
							ajaxRendered="true" 
							>
							<p:message
								for="yearOfBirth" 
								errorClass="errorMessage"
								infoClass="infoMessage"
								warnClass="warnMessage"
								fatalClass="fatalMessage" />
						</p:outputPanel>
						<!-- ....... Institution.......           -->
						<p:outputPanel
							rendered="#{(authorManagedBean.pleaseInstitution)}"
							ajaxRendered="true">
							<mytags:outputLabel 
								value="#{messages['records.author.editPanel.institution']}" 
								for="institution" 
								errorStyleClass="errorMessage"
								/>
						</p:outputPanel>
						<p:fragment
					        rendered="#{(authorManagedBean.pleaseInstitution) and (authorManagedBean.editMode != modesManagedBean.viewDetails)}" >
							<p:autoComplete
					            id="institution"
					            value="#{authorManagedBean.selectedAuthor.institution.someName}" 
								mode="cachedAjax"
								autocompleteMethod="#{institutionManagedBean.autocompleteUNS}" 
					            var="_institutionRow"
					            fetchValue="#{_institutionRow.controlNumber}" 
					            minChars="3" 
					            selectFirst="false"
					            style="width:100% !important;"
				         		onselectitem="if(this.value.indexOf('(BISIS)') != -1){activeElId = 'aInput'; pickControlNumber(this, #{rich:element('controlNumber')});choose(#{rich:element('controlNumber')}.value)}" 
					            onkeyup="pickControlNumber(this, #{rich:element('controlNumber')})"
					            onfocus="activeElId = this.id;"
					            onblur="activeElId = null;"
					            >
					            <!--   ........  IME Institucije   .......   -->
								<p:column
									style="'background-color:#{org.richfaces.SKIN.tableBackgroundColor}';"
									styleClass="rich-table-wide-cell" >
									<h:outputText value="#{_institutionRow.someName}" />
								</p:column>
								<p:remoteCommand
									name="choose" 
									action="#{institutionManagedBean.chooseInstitution}" 
									render="#{authorManagedBean.renderModalPanels}">
								<a4j:param 
									name="param1" 
									assignTo="#{institutionManagedBean.institutionControlNumber}"/>
								</p:remoteCommand>
							</p:autoComplete>
						</p:fragment>
						<p:inputTextarea
							rendered="#{(authorManagedBean.pleaseInstitution) and (authorManagedBean.editMode == modesManagedBean.viewDetails)}"
							readonly="true"
							value="#{authorManagedBean.selectedAuthor.institution.name.content}" 
							rows="3"
							/>
						<h:inputHidden 
							id="controlNumber"
							rendered="#{(authorManagedBean.pleaseInstitution)}"/>
						<h:outputText 
							rendered="#{(authorManagedBean.pleaseInstitution)}"
							value=""  
							/>
						<p:outputPanel
							rendered="#{(authorManagedBean.pleaseInstitution)}"
							ajaxRendered="true" 
							>
							<p:message
								for="institution" 
								errorClass="errorMessage"
								infoClass="infoMessage"
								warnClass="warnMessage"
								fatalClass="fatalMessage" />
						</p:outputPanel>
						<!-- ....... OrganizationUnit.......           -->
						<p:outputPanel
							ajaxRendered="true"
							rendered="#{(authorManagedBean.editMode == modesManagedBean.viewDetails) or (authorManagedBean.editMode == modesManagedBean.import)}" >
							<mytags:outputLabel 
								value="#{messages['records.author.editPanel.organizationUnit']}" 
								for="organizationUnit" 
								errorStyleClass="errorMessage"
								/>
						</p:outputPanel>
						<p:inputTextarea
							id="organizationUnit"
							rendered="#{(authorManagedBean.editMode == modesManagedBean.viewDetails) or (authorManagedBean.editMode == modesManagedBean.import)}"
							readonly="true" 
							value="#{authorManagedBean.selectedAuthor.organizationUnit}"
							rows="3" 
							required="true" />
						<p:commandButton
							rendered="#{(authorManagedBean.editMode == modesManagedBean.import)}"
							action="#{authorManagedBean.pickOrganizationUnit}"
							render="institutionBrowseModalPanel"
							value="#{messages['records.author.editPanel.btnPickOrganizationUnit']}" 
							execute="@form" />
						<h:outputText value=""
							rendered="#{(authorManagedBean.editMode == modesManagedBean.viewDetails)}" />
						<h:outputText
							rendered="#{(authorManagedBean.editMode == modesManagedBean.viewDetails) or (authorManagedBean.editMode == modesManagedBean.import)}" 
							value=""  
							/>
						<p:outputPanel
							ajaxRendered="true"
							rendered="#{(authorManagedBean.editMode == modesManagedBean.viewDetails) or (authorManagedBean.editMode == modesManagedBean.import)}" 
							>
							<p:message
								for="organizationUnit" 
								errorClass="errorMessage"
								infoClass="infoMessage"
								warnClass="warnMessage"
								fatalClass="fatalMessage" />
						</p:outputPanel>
						<!-- ....... Title ...... -->          
						<p:outputPanel
							rendered="#{userManagedBean.privileges[privilegesManagedBean.formAuthor][privilegesManagedBean.editFullData]}"
							ajaxRendered="true">
							<mytags:outputLabel 
								value="#{messages['records.author.editPanel.title']}" 
								for="title" 
								errorStyleClass="errorMessage"
								/>
						</p:outputPanel>
						<p:inputText
							id="title"
							rendered="#{userManagedBean.privileges[privilegesManagedBean.formAuthor][privilegesManagedBean.editFullData]}"
							value="#{authorManagedBean.selectedAuthor.title}"
							maxlength="100"  
							readonly="#{(authorManagedBean.editMode == modesManagedBean.viewDetails)}"
							/>
						<h:outputText 
							value=""  
							rendered="#{userManagedBean.privileges[privilegesManagedBean.formAuthor][privilegesManagedBean.editFullData]}"
							/>
						<h:outputText 
							value=""  
							rendered="#{userManagedBean.privileges[privilegesManagedBean.formAuthor][privilegesManagedBean.editFullData]}"
							/>
						<p:outputPanel
							rendered="#{userManagedBean.privileges[privilegesManagedBean.formAuthor][privilegesManagedBean.editFullData]}"
							ajaxRendered="true" 
							>
							<p:message
								for="title" 
								errorClass="errorMessage"
								infoClass="infoMessage"
								warnClass="warnMessage"
								fatalClass="fatalMessage" />
						</p:outputPanel>
						
						<!-- ....... TitleYear.......            -->
						<p:outputPanel
							rendered="#{userManagedBean.privileges[privilegesManagedBean.formAuthor][privilegesManagedBean.editFullData]}"
							ajaxRendered="true">
							<mytags:outputLabel 
								value="#{messages['records.author.editPanel.titleInstitution.year']}" 
								for="titleYear" 
								errorStyleClass="errorMessage"
								/>
						</p:outputPanel>
						<p:inputText
							id="titleYear"
							rendered="#{userManagedBean.privileges[privilegesManagedBean.formAuthor][privilegesManagedBean.editFullData]}"
							value="#{authorManagedBean.selectedAuthor.titleInstitution.year}"
							maxlength="10"  
							readonly="#{(authorManagedBean.editMode == modesManagedBean.viewDetails)}"
							/>
						<h:outputText 
							value=""  
							rendered="#{userManagedBean.privileges[privilegesManagedBean.formAuthor][privilegesManagedBean.editFullData]}"
							/>
						<h:outputText 
							value=""  
							rendered="#{userManagedBean.privileges[privilegesManagedBean.formAuthor][privilegesManagedBean.editFullData]}"
							/>
						<p:outputPanel
							rendered="#{userManagedBean.privileges[privilegesManagedBean.formAuthor][privilegesManagedBean.editFullData]}"
							ajaxRendered="true" 
							>
							<p:message
								for="titleYear" 
								errorClass="errorMessage"
								infoClass="infoMessage"
								warnClass="warnMessage"
								fatalClass="fatalMessage" />
						</p:outputPanel>
						   
						<!-- ....... TitleInstituion.......            -->
						<p:outputPanel
							rendered="#{userManagedBean.privileges[privilegesManagedBean.formAuthor][privilegesManagedBean.editFullData]}"
							ajaxRendered="true">
							<mytags:outputLabel 
								value="#{messages['records.author.editPanel.titleInstitution.institution']}" 
								for="titleInstitution" 
								errorStyleClass="errorMessage"
								/>
						</p:outputPanel>
						<p:inputTextarea
							id="titleInstitution"
							rendered="#{userManagedBean.privileges[privilegesManagedBean.formAuthor][privilegesManagedBean.editFullData]}"
							value="#{authorManagedBean.selectedAuthor.titleInstitution.institution.name.content}"
							readonly="#{(authorManagedBean.editMode == modesManagedBean.viewDetails)}"
							rows="3"
							/>
						<h:outputText 
							value=""  
							rendered="#{userManagedBean.privileges[privilegesManagedBean.formAuthor][privilegesManagedBean.editFullData]}"
							/>
						<h:outputText 
							value=""  
							rendered="#{userManagedBean.privileges[privilegesManagedBean.formAuthor][privilegesManagedBean.editFullData]}"
							/>
						<p:outputPanel
							rendered="#{userManagedBean.privileges[privilegesManagedBean.formAuthor][privilegesManagedBean.editFullData]}"
							ajaxRendered="true" 
							>
							<p:message
								for="titleInstitution" 
								errorClass="errorMessage"
								infoClass="infoMessage"
								warnClass="warnMessage"
								fatalClass="fatalMessage" />
						</p:outputPanel>
						
						<!-- ....... Position.......           -->
						<p:outputPanel
							ajaxRendered="true"
							rendered="#{authorManagedBean.editMode == modesManagedBean.import}" >
							<mytags:outputLabel 
								value="#{messages['records.author.editPanel.position']}" 
								for="position" 
								errorStyleClass="errorMessage"
								/>
						</p:outputPanel>
						<p:selectOneMenu
							id="position"
							rendered="#{authorManagedBean.editMode == modesManagedBean.import}"
							value="#{authorManagedBean.selectedAuthor.currentPosition.position}"
							readonly="#{authorManagedBean.selectedAuthor.controlNumber==null}"
							converter="positionSelectConverter"
							>
							<f:selectItems value="#{positionManagedBean.allList}"/>
						</p:selectOneMenu>
						<p:calendar
							rendered="#{authorManagedBean.editMode == modesManagedBean.import}"
							value="#{authorManagedBean.selectedAuthor.currentPosition.startDate.time}"
							enableManualInput="true"
							datePattern="dd/MM/yyyy"
							firstWeekDay="1"
							required="true"
							dayDisableFunction="disablementFutureDate"
							dayClassFunction="disablementFutureStyleClass"
							showFooter="false"
							showWeekDaysBar="false"
							showWeeksBar="false" 
							inputStyle="width:120px" />
						<p:commandButton
							rendered="#{authorManagedBean.editMode == modesManagedBean.import}"
							action="#{authorManagedBean.authorPositions}"
							value="#{messages['records.author.editPanel.btnFormerPositions']}"
							render="authorPositionEditModalPanel" 
							execute="@this"/>
						<h:outputText 
							rendered="#{authorManagedBean.editMode == modesManagedBean.import}"
							value="" />
						<p:outputPanel
							ajaxRendered="true"
							rendered="#{authorManagedBean.editMode == modesManagedBean.import}">
							<p:message
								for="position" 
								errorClass="errorMessage"
								infoClass="infoMessage"
								warnClass="warnMessage"
								fatalClass="fatalMessage" />
						</p:outputPanel>
						
						   
						
					</h:panelGrid> 
				</p:tab>
				<p:tab
					name="tab1"
					header="#{messages['records.author.editPanel.secondTab']}"
					rendered="#{(authorManagedBean.editTabNumber == 1) and ((authorManagedBean.editMode == modesManagedBean.add) or (authorManagedBean.editMode == modesManagedBean.register) or (authorManagedBean.editMode == modesManagedBean.import))}">
					<p:outputPanel ajaxRendered="true">
						<h:panelGrid columns="2">
							<h:graphicImage library="img" name="info.png" />
							<h:outputText value="#{authorManagedBean.pickSimilarMessage}"
								styleClass="rf-msg-inf" />
						</h:panelGrid>
					</p:outputPanel>
					<p:spacer
						height="10"
						width="1"
						/>
					<p:dataTable
						id="authorTable" 
						value="#{authorManagedBean.similarAuthors}"
						var="authorRow" >
						<!--     ........  names   .......-->
						<p:column>
							<f:facet name="header">
								<h:outputText value="#{messages['records.author.tablePanel.names']}" />
							</f:facet>
							<h:outputText value="#{authorRow.names}" />
						</p:column>
						<!--     ........  year of birth   .......-->
						<p:column>
							<f:facet name="header">
								<h:outputText
									value="#{messages['records.author.tablePanel.yearOfBirth']}" />
							</f:facet>
							<h:outputText value="#{authorRow.yearOfBirth}" />
						</p:column>
						<!--     ........  institution   .......-->
						<p:column>
							<f:facet name="header">
								<h:outputText
									value="#{messages['records.author.tablePanel.institution']}" />
							</f:facet>
							<h:outputText value="#{authorRow.institutionName}" />
						</p:column>
						<!--     ........  title   .......-->
						<p:column>
							<f:facet name="header">
								<h:outputText
									value="#{messages['records.author.tablePanel.title']}" />
							</f:facet>
							<h:outputText value="#{authorRow.title}" />
						</p:column>
						<!--     ........  position   .......-->
						<p:column>
							<f:facet name="header">
								<h:outputText
									value="#{messages['records.author.tablePanel.position']}" />
							</f:facet>
							<h:outputText value="#{authorRow.currentPositionName}" />
						</p:column>
						<!--     ........  chooseSimilar   .......
						or ((authorManagedBean.editMode == modesManagedBean.import) and (userManagedBean.loggedIn) and (userManagedBean.privileges[privilegesManagedBean.formImport][privilegesManagedBean.editFullData]))}"
						and (userManagedBean.loggedIn) and (not userManagedBean.privileges[privilegesManagedBean.formImport][privilegesManagedBean.editFullData])}"
						-->
						<p:column>
							<f:facet name="header">
								<h:outputText
									value="#{messages['records.author.tablePanel.chooseSimilar']}" />
							</f:facet>
							<p:commandLink
								action="#{authorManagedBean.chooseSimilar}"
								render="mainPanel, #{authorManagedBean.renderModalPanels}"
								rendered="#{(authorManagedBean.editMode != modesManagedBean.import)}" 
								limitRender="true"
								immediate="true"
								execute="@this">
								<h:graphicImage library="img" name="pick.png" />
								<f:param name="controlNumber" value="#{authorRow.controlNumber}" />
								<p:tooltip followMouse="true" direction="topRight"
									showDelay="1000" styleClass="tooltip" mode="client">
									<span class="tooltipSpan"> 
										<h:panelGrid columns="2">
											<h:graphicImage library="img" name="pickToolTip.png" />
											<h:outputText
												value="#{messages['records.author.tablePanel.btnPick']}" />
										</h:panelGrid> 
									</span>
								</p:tooltip>
							</p:commandLink>
							<p:commandLink
								action="#{authorManagedBean.examineData}"
								render="mainPanel, #{authorManagedBean.renderModalPanels}"
								rendered="#{(authorManagedBean.editMode == modesManagedBean.import)}" 
								limitRender="true"
								immediate="true"
								execute="@this">
								<h:graphicImage library="img" name="pick.png" />
								<f:param name="controlNumber" value="#{authorRow.controlNumber}" />
								<p:tooltip followMouse="true" direction="topRight"
									showDelay="1000" styleClass="tooltip" mode="client">
									<span class="tooltipSpan"> 
										<h:panelGrid columns="2">
											<h:graphicImage library="img" name="pickToolTip.png" />
											<h:outputText
												value="#{messages['records.author.tablePanel.btnExamine']}" />
										</h:panelGrid> 
									</span>
								</p:tooltip>
							</p:commandLink>
							<p:commandLink
								render="relatedRecordsEditModalPanel"
							    execute="@this" 
							    limitRender="true">
							    <h:graphicImage library="img" name="publications.png" />
							    <f:setPropertyActionListener target="#{relatedRecordsManagedBean.selectedRecord}"
							        value="#{authorRow}" />
							    <p:tooltip followMouse="true" direction="topRight"
									showDelay="1000" styleClass="tooltip" mode="client">
									<span class="tooltipSpan"> 
										<h:panelGrid columns="2">
											<h:graphicImage library="img" name="publicationsToolTip.png" />
											<h:outputText
												value="#{messages['records.author.tablePanel.btnPublications']}" />
										</h:panelGrid> 
									</span>
								</p:tooltip>
							</p:commandLink>
						</p:column>
						<!--     ........  examineThis   
						#{(authorManagedBean.editMode == modesManagedBean.import) and (userManagedBean.loggedIn) and (userManagedBean.privileges[privilegesManagedBean.formImport][privilegesManagedBean.editFullData])}
						.......-->
						<p:column
							rendered="false">
							<f:facet name="header">
								<h:outputText
									value="#{messages['records.author.tablePanel.examine']}" />
							</f:facet>
							<p:commandLink
								action="#{authorManagedBean.examineData}"
								render="mainPanel, #{authorManagedBean.renderModalPanels}"
								limitRender="true"
								immediate="true"
								execute="@this">
								<h:graphicImage library="img" name="pick.png" />
								<f:param name="controlNumber" value="#{authorRow.controlNumber}" />
								<p:tooltip followMouse="true" direction="topRight"
									showDelay="1000" styleClass="tooltip" mode="client">
									<span class="tooltipSpan"> 
										<h:panelGrid columns="2">
											<h:graphicImage library="img" name="pickToolTip.png" />
											<h:outputText
												value="#{messages['records.author.tablePanel.btnExamine']}" />
										</h:panelGrid> 
									</span>
								</p:tooltip>
							</p:commandLink>
						</p:column>
						<!--     ........  mergeWithThis   .......-->
						<p:column
							rendered="false">
							<f:facet name="header">
								<h:outputText
									value="#{messages['records.author.tablePanel.merge']}" />
							</f:facet>
							<p:commandLink
								action="#{authorManagedBean.mergeData}"
								render="mainPanel, #{authorManagedBean.renderModalPanels}"
								limitRender="true"
								immediate="true"
								execute="@this">
								<h:graphicImage library="img" name="pick.png" />
								<f:param name="controlNumber" value="#{authorRow.controlNumber}" />
								<p:tooltip followMouse="true" direction="topRight"
									showDelay="1000" styleClass="tooltip" mode="client">
									<span class="tooltipSpan"> 
										<h:panelGrid columns="2">
											<h:graphicImage library="img" name="pickToolTip.png" />
											<h:outputText
												value="#{messages['records.author.tablePanel.btnMerge']}" />
										</h:panelGrid> 
									</span>
								</p:tooltip>
							</p:commandLink>
						</p:column>
					</p:dataTable>
				</p:tab>
				<p:tab
					name="tab2"
					header="#{messages['records.author.editPanel.thirdTab']}"
					rendered="#{(authorManagedBean.editMode == modesManagedBean.viewDetails)}">
					<p:outputPanel ajaxRendered="true">
						<p:inputTextarea
							readonly="true" 
							value="#{authorManagedBean.selectedAuthor.record.MARC21Record.printableString}"
							cols="60" 
							styleClass="marc21TextArea" />
					</p:outputPanel>
				</p:tab>
			</p:tabView>
		</p:panel>
		<!--================= Update, Create, Cancel buttons ====================  -->
		<h:panelGrid columns="2">
			<p:commandButton
				rendered="#{((authorManagedBean.editMode == modesManagedBean.update) or ((authorManagedBean.editMode == modesManagedBean.import) and (not empty authorManagedBean.selectedAuthor.controlNumber))) and ((authorManagedBean.editTabNumber == 0) or (authorManagedBean.editTabNumber == 1))}"
				action="#{authorManagedBean.update}"
				value="#{messages['records.author.editPanel.btnUpdate']}"
				render="authorEditModalPanel" 
				limitRender="true" 
				execute="@form" />
			<p:commandButton
				rendered="#{((authorManagedBean.editMode == modesManagedBean.add) or ((authorManagedBean.editMode == modesManagedBean.import) and (empty authorManagedBean.selectedAuthor.controlNumber))) and ((authorManagedBean.editTabNumber == 0) or (authorManagedBean.editTabNumber == 1))}"
				action="#{authorManagedBean.add}"
				value="#{messages['records.author.editPanel.btnCreate']}"
				render="mainPanel, #{authorManagedBean.renderModalPanels}" 
				limitRender="true" />
			<p:commandButton
				rendered="#{(authorManagedBean.editMode == modesManagedBean.import) and (authorManagedBean.editTabNumber == 5)}"
				action="#{authorManagedBean.examineData}"
				value="#{messages['records.author.editPanel.btnExamine']}"
				render="authorEditModalPanel" 
				limitRender="true" 
				execute="@this" />
			<p:commandButton
				rendered="#{(authorManagedBean.editTabNumber == 2)}" 
				action="#{authorManagedBean.finishWizard}"
				value="#{messages['records.author.editPanel.btnAllRight']}"
				render="mainPanel, #{authorManagedBean.renderModalPanels}"
				limitRender="true"
				immediate="true" 
				execute="@this" />
		</h:panelGrid>
	</h:panelGrid>	
</ui:composition>
