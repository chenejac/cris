<ui:composition xmlns="http://www.w3.org/1999/xhtml"
     xmlns:ui="http://java.sun.com/jsf/facelets"
     xmlns:h="http://java.sun.com/jsf/html"
     xmlns:f="http://java.sun.com/jsf/core"
     xmlns:p="http://primefaces.org/ui"
     xmlns:mytags="http://dragan.tmd.uns.ac.rs/mytags">

	<p:panel id="publicationPreview"
		header="#{messages['records.jobAd.publications.preview']}">
		<p:inputText id="general" rendered="false" value="" />
		<p:outputPanel ajaxRendered="true">
			<p:message
				for="general"
				errorClass="errorMessage"
				infoClass="infoMessage"
				warnClass="warnMessage"
				fatalClass="fatalMessage"/>
		</p:outputPanel>
		<p:outputPanel ajaxRendered="true">
			<h:panelGrid columns="1">
				<h:outputText
					value="#{jobAdManagedBean.selectedJobAdPublications.HTMLRepresentation}"
					styleClass="preview" 
					escape="false"/>
			</h:panelGrid>
		</p:outputPanel>
		<p:outputPanel ajaxRendered="true">
			<h:panelGrid columns="1">
				<h:outputText
					value="#{jobAdManagedBean.selectedAuthor.HTMLRepresentation}"
					styleClass="preview" 
					escape="false"/>
			</h:panelGrid>
		</p:outputPanel>
		<p:panel
			id="scrollableBody"
			styleClass="scrollableBody"
			>
			<h:panelGrid 
				rendered="#{not empty jobAdManagedBean.publications}"
				>
				<p:dataTable
					id="publicationTable"
					value="#{jobAdManagedBean.publications}"
					var="publicationRow" 
					rows="10"
					paginator="true" paginatorPosition="bottom"
					paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
					currentPageReportTemplate="#{userManagedBean.currentPageReportTemplate}"
					rowsPerPageTemplate="#{userManagedBean.rowsPerPageTemplate}"
					>
					<p:column>
						<f:facet name="header">
							<h:outputText
								value="#{messages['records.jobAd.publications.records']}" />
						</f:facet>
						<h:outputText value="#{publicationRow.publication.stringRepresentation}" />
					</p:column>
					<p:column
						rendered="#{(userManagedBean.loggedIn) and (not empty userManagedBean.loggedUser.author.controlNumber) and (userManagedBean.loggedUser.author.controlNumber eq jobAdManagedBean.selectedAuthor.controlNumber)}">
						<f:facet name="header">
							<h:outputText
								value="#{messages['records.jobAd.publications.actions']}" />
						</f:facet>
						<p:selectBooleanCheckbox value="#{publicationRow.selected}" />
					</p:column>
				</p:dataTable>
			</h:panelGrid>
			<h:panelGrid 
				rendered="#{empty jobAdManagedBean.publications}">
				<h:outputText
					value="#{messages['records.jobAd.publications.norecords']}"
					styleClass="rf-msg-inf" />
			</h:panelGrid>
		</p:panel>
	</p:panel>
	<!--================= Update, Create, Cancel buttons ====================  -->
	<h:panelGrid 
		columns="3"
		rendered="#{(userManagedBean.loggedIn) and (not empty userManagedBean.loggedUser.author.controlNumber) and (userManagedBean.loggedUser.author.controlNumber eq jobAdManagedBean.selectedAuthor.controlNumber)}" >
		<p:commandButton
			action="#{jobAdManagedBean.updateSelectedPublications}"
			value="#{messages['records.jobAd.editPanel.btnUpdate']}"
			update="publicationPreview"
			limitRender="true" 
			execute="@form" />
		<p:commandButton
			action="#{jobAdManagedBean.selectAllPublications}"
			value="#{messages['records.jobAd.editPanel.btnSelectAll']}"
			update="publicationPreview"
			limitRender="true" 
			execute="this" />
		<p:commandButton
			action="#{jobAdManagedBean.deselectAllPublications}"
			value="#{messages['records.jobAd.editPanel.btnDeselectAll']}"
			update="publicationPreview"
			limitRender="true" 
			execute="this" />
	</h:panelGrid>
</ui:composition>