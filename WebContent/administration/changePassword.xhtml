<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
     xmlns:ui="http://java.sun.com/jsf/facelets"
     xmlns:h="http://java.sun.com/jsf/html"
     xmlns:f="http://java.sun.com/jsf/core"
     xmlns:p="http://primefaces.org/ui"
     xmlns:mytags="http://dragan.tmd.uns.ac.rs/mytags"
     >
	<f:view locale="#{userManagedBean.language}">
		<h:head>
			<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
			<meta http-equiv="Refresh" content="#{session.maxInactiveInterval};url=index.html" />
			<meta http-equiv="Pragma" content="no-cache"/>
			<meta http-equiv="Expires" content="-1"/>
			<title><ui:insert name="title">CRIS UNS</ui:insert></title>
		</h:head>
		<h:body onload="formId='form'; setFocus();">
			<h:outputStylesheet library="stylesheet" name="theme.css" target="head"/>
			<h:outputScript library="js" name="functions.js" target="head"/>
			<f:loadBundle
				basename="rs.ac.uns.ftn.informatika.bibliography.utils.ResourceBoundles"
				var="messages" />
			<div id="header">
    			<ui:insert name="header">
    				<ui:include src="../header.xhtml"/>
    			</ui:insert>
			</div>
			<div id="center">
				<p:spacer
					height="20"
					width="1"
					/>
				<div id="pleaseWait" class="transparent"></div>
				<div id="progressBar" class="progressbar">
					<h:graphicImage library="img" name="progressbar.gif" />
				</div>
				<p:ajaxStatus for="form_region" onstart="onStart()" oncomplete="onStop()" />
				<p:fragment id="form_region" rendered="#{userManagedBean.loggedIn}">
					<h:form id="form">
						<!-- ===========================   change password Panel  ============================= -->
						<p:panel id="changePasswordPanel"
							header="#{messages['administration.changePassword.header']}">
							<p:inputText id="general" rendered="false" value="" />
							<p:outputPanel ajaxRendered="true">
								<p:message
									for="general"
									errorClass="errorMessage"
									infoClass="infoMessage"
									warnClass="warnMessage"
									fatalClass="fatalMessage"/>
							</p:outputPanel>
							<h:panelGrid columns="3" columnClasses="width25, width35, width40" width="100%">
								<!-- ....... EMail.......           -->
								<p:outputPanel ajaxRendered="true">
									<mytags:outputLabel 
										value="#{messages['administration.changePassword.email']}*" 
										for="email" 
										errorStyleClass="errorMessage"
										/>
								</p:outputPanel>
								<p:inputText
									id="email" 
									value="#{userManagedBean.loggedUser.email}"
									readonly="true" 
									maxlength="50" 
									required="true" />
								<p:outputPanel ajaxRendered="true">
									<p:message
										for="email" 
										errorClass="errorMessage"
										infoClass="infoMessage"
										warnClass="warnMessage"
										fatalClass="fatalMessage" />
								</p:outputPanel>
								<!-- ....... Old Password.......           -->
								<p:outputPanel ajaxRendered="true">
									<mytags:outputLabel 
										value="#{messages['administration.changePassword.oldPassword']}*" 
										for="oldPassword" 
										errorStyleClass="errorMessage"
										/>
								</p:outputPanel>
								<p:password
									id="oldPassword"
									value="#{userManagedBean.oldPassword}" 
									maxlength="10"
									required="true" />
								<p:outputPanel ajaxRendered="true">
									<p:message
										for="oldPassword" 
										errorClass="errorMessage"
										infoClass="infoMessage"
										warnClass="warnMessage"
										fatalClass="fatalMessage" />
								</p:outputPanel>
								<!-- ....... New password.......           -->
								<p:outputPanel ajaxRendered="true">
									<mytags:outputLabel 
										value="#{messages['administration.changePassword.newPassword']}*" 
										for="newPassword" 
										errorStyleClass="errorMessage"
										/>
								</p:outputPanel>
								<p:password
									id="newPassword"
									value="#{userManagedBean.newPassword}" 
									maxlength="10"
									required="true" />
								<p:outputPanel ajaxRendered="true">
									<p:message
										for="newPassword" 
										errorClass="errorMessage"
										infoClass="infoMessage"
										warnClass="warnMessage"
										fatalClass="fatalMessage" />
								</p:outputPanel>
								<!-- ....... Repeated new password.......           -->
								<p:outputPanel ajaxRendered="true">
									<mytags:outputLabel 
										value="#{messages['administration.changePassword.repeatedNewPassword']}*" 
										for="repeatedNewPassword" 
										errorStyleClass="errorMessage"
										/>
								</p:outputPanel>
								<p:password
									id="repeatedNewPassword"
									value="#{userManagedBean.repeatedNewPassword}" 
									maxlength="10"
									required="true"
									onkeydown="keyDownHandler(event, 'form:submit')" />
								<p:outputPanel ajaxRendered="true">
									<p:message
										for="repeatedNewPassword" 
										errorClass="errorMessage"
										infoClass="infoMessage"
										warnClass="warnMessage"
										fatalClass="fatalMessage" />
								</p:outputPanel>
							</h:panelGrid>
							<br />
							<!--================= Change, Cancel buttons ====================  -->
							<h:panelGrid columns="2">
								<p:commandButton
									id="submit"
									action="#{userManagedBean.changePassword}"
									value="#{messages['administration.changePassword.btnChange']}"
									render="changePasswordPanel" 
									limitRender="true" 
									execute="@form"/>
								<p:commandButton
									action="#{userManagedBean.exit}"
									value="#{messages['administration.changePassword.btnCancel']}"
									immediate="true"
									execute="@this" />
							</h:panelGrid>
						</p:panel>
					</h:form>
				</p:fragment>
			</div>
			<p:spacer
				height="70"
				width="1"/>
			<div id="footer">
    			<ui:insert name="footer">
					<ui:include src="../footer.xhtml"/>
				</ui:insert>
			</div>
		</h:body>
	</f:view>
</html>