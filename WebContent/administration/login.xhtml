<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
     xmlns:ui="http://java.sun.com/jsf/facelets"
     xmlns:h="http://java.sun.com/jsf/html"
     xmlns:f="http://java.sun.com/jsf/core"
     xmlns:p="http://primefaces.org/ui"
     xmlns:mytags="http://dragan.tmd.uns.ac.rs/mytags"
     >
	<f:view locale="#{userManagedBean.language}"
		beforePhase="#{userManagedBean.loginPageEnter}">
		<h:head>
			<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
			<meta http-equiv="Refresh" content="#{session.maxInactiveInterval};url=index.html" />
			<meta http-equiv="Pragma" content="no-cache"/>
			<meta http-equiv="Expires" content="-1"/>
			<title><ui:insert name="title">CRIS UNS</ui:insert></title>
		</h:head>
		<h:body onload="formId='login'; setFocus(); " styleClass="body">
			<h:outputStylesheet library="stylesheet" name="theme.css" target="head"/>
			<h:outputScript library="js" name="functions.js" target="head"/>
			<f:loadBundle
				basename="rs.ac.uns.ftn.informatika.bibliography.utils.ResourceBoundles"
				var="messages" />
			<div id="header">
    			<ui:insert name="header">
    				<ui:include src="../header.xhtml"/>
    			</ui:insert>
			</div>
			<div id="center">
				<p:spacer
						height="20"
						width="1" />
				<div id="pleaseWait" class="transparent"></div>
				<div id="progressBar" class="progressbar">
					<h:graphicImage library="img" name="progressbar.gif" />
				</div>
				<p:ajaxStatus for="form_region" onstart="onStart()" oncomplete="onStop()" />
				<p:fragment id="form_region" rendered="#{not userManagedBean.loggedIn}">
					<h:form id="login" >
						<p:panel id="loginPanel"
									header="#{messages['administration.login.header']}">
							<p:inputText id="general"
								rendered="false" 
								value="" />
							<p:outputPanel ajaxRendered="true">
								<p:message
									for="general"
									errorClass="errorMessage"
									infoClass="infoMessage"
									warnClass="warnMessage"
									fatalClass="fatalMessage"/>
							</p:outputPanel>
							<p:outputPanel
								ajaxRendered="true" 
								rendered="#{userManagedBean.authorAlreadyRegisteredMessage!=null}">
								<h:panelGrid columns="2">
									<h:graphicImage library="img" name="info.png" />
									<h:outputText value="#{userManagedBean.authorAlreadyRegisteredMessage}"
										styleClass="ui-message-info" />
								</h:panelGrid>
							</p:outputPanel>
							<h:panelGrid columns="3">
								<p:outputPanel ajaxRendered="true">
									<mytags:outputLabel 
										value="#{messages['administration.login.email']}" 
										for="email" 
										errorStyleClass="errorMessage"
										/>
								</p:outputPanel>
								<p:inputText
									id="email" 
									value="#{userManagedBean.loggedUser.email}"
									maxlength="50" 
									required="true">
									<p:clientValidator />
								</p:inputText>
								<p:outputPanel ajaxRendered="true">
									<p:message
										for="email" 
										errorClass="errorMessage"
										infoClass="infoMessage"
										warnClass="warnMessage"
										fatalClass="fatalMessage" />
								</p:outputPanel>
								<p:outputPanel ajaxRendered="true">
									<mytags:outputLabel 
										value="#{messages['administration.login.password']}" 
										for="password" 
										errorStyleClass="errorMessage"
										/>
								</p:outputPanel>
								<p:password
									id="password"
									value="#{userManagedBean.loggedUser.password}" 
									maxlength="10"
									onkeydown="keyDownHandler(event, 'login:loginBtn')" />
								<p:outputPanel ajaxRendered="true">
									<p:message
										for="password" 
										errorClass="errorMessage"
										infoClass="infoMessage"
										warnClass="warnMessage"
										fatalClass="fatalMessage" />
								</p:outputPanel>
								<h:outputText value="" />
								<h:panelGroup>
									<p:commandButton id="loginBtn"
										value="#{messages['administration.login.btnLogin']}"
										action="#{userManagedBean.login}"
										update="loginPanel"
										limitRender="true"
										execute="@form" 
										/>
									<p:commandButton id="cancelBtn"
										value="#{messages['administration.login.btnCancel']}"
										action="#{userManagedBean.exit}" 
										immediate="true" 
										execute="@this"/>
									<p:commandLink
										action="#{userManagedBean.accountEmailNotification}" 
										value="#{messages['administration.login.notification.pleaseNotification']}" 
										execute="@form"
										render="@form"
										limitRender="true"/>
								</h:panelGroup>
								<h:outputText value="" />
							</h:panelGrid>
						</p:panel>
					</h:form>
				</p:fragment>
			</div>
			<p:spacer
				height="70"
				width="1"/>
			<div id="footer">
    			<ui:insert name="footer">
					<ui:include src="../footer.xhtml"/>
				</ui:insert>
			</div>
		</h:body>
	</f:view>
</html>
